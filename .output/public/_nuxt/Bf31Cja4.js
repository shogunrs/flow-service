import{r as h,$ as Q,G as T,y as C,c as o,o as s,a,l as m,b as R,t as c,d as z,F as k,k as V,w as M,i as g,m as y,q as $,I as W}from"./qcAyaCsh.js";const X={class:"space-y-2"},Y={class:"flex items-center justify-between"},Z={class:"text-[12px] text-slate-300"},ee=["disabled"],te={key:0,class:"flex flex-wrap gap-2"},le={class:"truncate max-w-[160px]"},ae=["onClick"],ne={key:1,class:"text-[11px] text-slate-400"},oe={key:2,class:"space-y-1"},se={class:"text-[11px] uppercase tracking-wide text-slate-400"},re={class:"flex flex-wrap gap-2"},ie={class:"truncate max-w-[200px]"},de=["onClick"],ue={class:"space-y-4"},ce={class:"max-h-64 overflow-y-auto rounded-lg border border-slate-800 bg-slate-900/60"},pe={key:0,class:"px-3 py-4 text-center text-sm text-slate-500"},me=["onClick"],xe={class:"truncate max-w-[240px] text-left"},fe={key:0,class:"space-y-3"},be={class:"space-y-2"},ve={class:"grid grid-cols-1 sm:grid-cols-3 gap-2"},ge={class:"flex items-center gap-2"},ye={key:0,class:"text-[11px] text-amber-300"},he={key:0,class:"space-y-1"},Ce={class:"text-[11px] uppercase tracking-wide text-slate-400"},we={class:"flex flex-wrap gap-2"},ke={class:"truncate max-w-[200px]"},Ve=["onClick"],Se={__name:"UserAccessManager",props:{users:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},label:{type:String,default:"Usuários autorizados"},description:{type:String,default:""},buttonText:{type:String,default:"Gerenciar acesso"},modalTitle:{type:String,default:"Selecionar usuários"},allowExternalContacts:{type:Boolean,default:!1},externalContacts:{type:Array,default:()=>[]},contactLabel:{type:String,default:"Contatos externos"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:externalContacts"],setup(r,{emit:P}){const i=r,w=P,f=h(!1),b=h(""),u=h(v(i.modelValue)),d=h(j(i.externalContacts)),x=h(""),n=Q({name:"",email:"",phone:"",cpf:"",cnpj:""});T(()=>i.modelValue,t=>{u.value=v(t)}),T(()=>i.externalContacts,t=>{d.value=j(t)});const _=C(()=>{const t=new Map;for(const e of i.users||[]){if(!e||!e.id)continue;const l=String(e.id),p=H(e);t.set(l,{id:l,label:p,raw:e})}return t}),A=C(()=>v(u.value).map(t=>_.value.get(t)||{id:t,label:t})),E=C(()=>d.value.map(K)),N=C(()=>{const t=b.value.trim().toLowerCase();return t?Array.from(_.value.values()).filter(e=>e.label.toLowerCase().includes(t)):Array.from(_.value.values())}),B=C(()=>new Set(u.value));function D(){i.disabled||(f.value=!0,b.value="",x.value="")}function F(t){const e=String(t),l=new Set(u.value);l.has(e)?l.delete(e):l.add(e),u.value=Array.from(l)}function I(t){i.disabled||(u.value=u.value.filter(e=>e!==t),w("update:modelValue",v(u.value)))}function G(){f.value=!1,u.value=v(i.modelValue),d.value=j(i.externalContacts),b.value="",x.value="",S()}function J(){w("update:modelValue",v(u.value)),i.allowExternalContacts&&w("update:externalContacts",d.value.map(U)),f.value=!1,b.value="",x.value="",S()}function q(){const t={name:n.name.trim(),email:n.email.trim(),phone:n.phone.trim(),cpf:n.cpf.trim(),cnpj:n.cnpj.trim()};if(!t.name){x.value="Informe o nome do contato.";return}if(!t.email&&!t.phone&&!t.cpf&&!t.cnpj){x.value="Informe pelo menos e-mail, telefone, CPF ou CNPJ.";return}x.value="",d.value=[...d.value,t],S()}function L(t){i.disabled||(d.value=d.value.filter((e,l)=>l!==t),f.value||w("update:externalContacts",d.value.map(U)))}function S(){n.name="",n.email="",n.phone="",n.cpf="",n.cnpj=""}function v(t){return Array.from(new Set((t||[]).filter(e=>typeof e=="string").map(e=>e.trim()).filter(Boolean)))}function H(t){const e=[t.name,t.email].filter(l=>typeof l=="string"&&l.trim());return e.length?e.join(" — "):String(t.id)}function j(t){return(t||[]).filter(Boolean).map(U)}function U(t){return{name:(t?.name||"").trim(),email:(t?.email||"").trim(),phone:(t?.phone||"").trim(),cpf:(t?.cpf||"").trim(),cnpj:(t?.cnpj||"").trim()}}function K(t){const e=[t.name,t.email,t.phone,t.cpf,t.cnpj].filter(l=>typeof l=="string"&&l.trim());return{...t,label:e.length?e.join(" • "):t.name||"Contato"}}return(t,e)=>(s(),o("div",X,[a("div",Y,[a("label",Z,c(r.label),1),a("button",{type:"button",class:"inline-flex items-center gap-2 rounded-md border border-slate-700 bg-slate-900 px-3 py-1.5 text-[12px] text-slate-200 hover:border-indigo-500/50 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed",disabled:r.disabled,onClick:D},[e[7]||(e[7]=a("i",{class:"fa-solid fa-user-plus text-xs"},null,-1)),z(" "+c(r.buttonText),1)],8,ee)]),A.value.length?(s(),o("div",te,[(s(!0),o(k,null,V(A.value,l=>(s(),o("span",{key:l.id,class:"inline-flex items-center gap-1 rounded-full bg-indigo-500/10 border border-indigo-500/30 px-2 py-1 text-[11px] text-indigo-200"},[a("span",le,c(l.label),1),r.disabled?m("",!0):(s(),o("button",{key:0,class:"text-indigo-200/80 hover:text-white",type:"button",onClick:p=>I(l.id)},[...e[8]||(e[8]=[a("i",{class:"fa-solid fa-xmark text-[10px]"},null,-1)])],8,ae))]))),128))])):m("",!0),r.description?(s(),o("p",ne,c(r.description),1)):m("",!0),r.allowExternalContacts&&E.value.length?(s(),o("div",oe,[a("label",se,c(r.contactLabel),1),a("div",re,[(s(!0),o(k,null,V(E.value,(l,p)=>(s(),o("span",{key:p+l.email+l.phone,class:"inline-flex items-center gap-1 rounded-full bg-amber-500/10 border border-amber-500/30 px-2 py-1 text-[11px] text-amber-200"},[a("span",ie,c(l.label),1),r.disabled?m("",!0):(s(),o("button",{key:0,class:"text-amber-200/80 hover:text-white",type:"button",onClick:O=>L(p)},[...e[9]||(e[9]=[a("i",{class:"fa-solid fa-xmark text-[10px]"},null,-1)])],8,de))]))),128))])])):m("",!0),R(W,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l),title:r.modalTitle,size:"md"},{footer:M(()=>[a("div",{class:"flex items-center justify-end gap-2"},[a("button",{class:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-300 hover:bg-slate-800",onClick:G}," Cancelar "),a("button",{class:"inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white transition hover:bg-indigo-500",onClick:J}," Confirmar ")])]),default:M(()=>[a("div",ue,[g(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"search",class:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"Buscar por nome ou e-mail"},null,512),[[y,b.value]]),a("div",ce,[N.value.length?m("",!0):(s(),o("div",pe," Nenhum usuário encontrado. ")),(s(!0),o(k,null,V(N.value,l=>(s(),o("button",{key:l.id,type:"button",class:$(["w-full flex items-center justify-between px-3 py-2 text-sm transition-colors border-b border-slate-800 last:border-b-0",B.value.has(l.id)?"bg-indigo-500/10 text-indigo-200 border-indigo-500/30":"text-slate-200 hover:bg-slate-800/60"]),onClick:p=>F(l.id)},[a("span",xe,c(l.label),1),a("i",{class:$(B.value.has(l.id)?"fa-solid fa-check text-indigo-300":"fa-regular fa-circle text-slate-500")},null,2)],10,me))),128))]),r.allowExternalContacts?(s(),o("div",fe,[a("div",be,[e[11]||(e[11]=a("label",{class:"text-[12px] text-slate-300 uppercase tracking-wide"},"Adicionar contato externo",-1)),a("div",ve,[g(a("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.name=l),type:"text",class:"rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"Nome"},null,512),[[y,n.name]]),g(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.email=l),type:"email",class:"rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"Email"},null,512),[[y,n.email]]),g(a("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.phone=l),type:"tel",class:"rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"Telefone"},null,512),[[y,n.phone]]),g(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.cpf=l),type:"text",class:"rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"CPF"},null,512),[[y,n.cpf]]),g(a("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.cnpj=l),type:"text",class:"rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 placeholder-slate-500 focus:border-indigo-500 focus:outline-none",placeholder:"CNPJ"},null,512),[[y,n.cnpj]])]),a("div",ge,[a("button",{type:"button",class:"inline-flex items-center gap-2 rounded-md bg-amber-500/20 px-3 py-1.5 text-[12px] text-amber-200 hover:bg-amber-500/30",onClick:q},[...e[10]||(e[10]=[a("i",{class:"fa-solid fa-plus text-xs"},null,-1),z(" Adicionar contato ",-1)])]),x.value?(s(),o("span",ye,c(x.value),1)):m("",!0)])]),d.value.length?(s(),o("div",he,[a("label",Ce,c(r.contactLabel),1),a("div",we,[(s(!0),o(k,null,V(d.value,(l,p)=>(s(),o("span",{key:p+l.email+l.phone,class:"inline-flex items-center gap-1 rounded-full bg-amber-500/10 border border-amber-500/30 px-2 py-1 text-[11px] text-amber-200"},[a("span",ke,c(l.label),1),a("button",{class:"text-amber-200/80 hover:text-white",type:"button",onClick:O=>L(p)},[...e[12]||(e[12]=[a("i",{class:"fa-solid fa-xmark text-[10px]"},null,-1)])],8,Ve)]))),128))])])):m("",!0)])):m("",!0)])]),_:1},8,["modelValue","title"])]))}};export{Se as _};
