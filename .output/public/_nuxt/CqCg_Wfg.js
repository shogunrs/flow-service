import{r as u,h as le,f as oe,c as g,a as t,b as C,m as ie,p as z,y as T,F as re,j as ne,w as b,A as N,x as ce,o as k,t as M,n as K,B as F}from"./CPKTtwfv.js";import{P as R}from"./BAMHYuh1.js";import{l as I,a as de,s as ue,r as ve,b as pe,c as B}from"./LTKILnWH.js";import{a as U,b as fe,s as me,e as ye}from"./BFT2zYfe.js";import{isApiEnabled as j}from"./Dbx-Jqc8.js";import{u as xe}from"./CB52pEDM.js";import{s as ge}from"./BWJBdaIx.js";import"./B74M8xGS.js";const be={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},ke={class:"p-6"},he={class:"bg-gray-800 rounded-lg p-4 space-y-3"},we={class:"space-y-3"},_e={class:"flex items-end gap-2 flex-wrap"},Ae={class:"min-w-[16rem]"},Ce=["disabled"],Se={key:0,class:"fa-solid fa-spinner fa-spin"},Pe={key:1,class:"fa-solid fa-plus"},De={class:"mt-1 space-y-2"},Me=["onClick"],Ee=["checked"],$e={class:"text-sm font-medium"},Ve={class:"text-[11px] text-slate-400"},Ne={class:"flex items-center gap-2"},Fe=["onClick","title","aria-label"],Ie=["onClick"],Ue=["onClick"],je={key:0,class:"mt-6"},qe={class:"space-y-4"},ze={class:"space-y-4"},Te={class:"text-slate-300"},Ke={class:"flex items-center justify-end gap-2"},Re={class:"flex items-center justify-end gap-2"},Xe={__name:"pipeline",setup(Be){const{setLastKey:f}=xe(),{success:E,error:$,info:J}=ce(),r=u(I()),l=u(r.value[0]?.key||""),S=u(""),h=u(!1),p=u(""),c=u([]),O=u(null),Z=u(null),m=u(!1),w=u(!1),_=u(!1),P=u(null);async function L(){const s=S.value.trim();if(!s)return;const e=globalThis.crypto?.randomUUID?.()||Math.random().toString(36).slice(2)+Date.now().toString(36);if(h.value)return;h.value=!0,r.value=[...r.value,{key:e,name:s,active:!0}],await de(e,s||e)?(l.value=e,f(e),S.value="",E("Processo criado")):(r.value=r.value.filter(o=>o.key!==e),$("Falha ao criar processo. Tente novamente.")),h.value=!1}function G(s){ue(s.key,s.active===!1),r.value=I()}async function H(s){l.value=s.key;const e=await U(s.key);c.value=Array.isArray(e)?e.map(o=>({id:o.id,title:o.title,slaDays:o.slaDays,color:o.color})):[],f(s.key);const a=r.value.find(o=>o.key===s.key);p.value=a?.name||s.key,await V(),m.value=!0}function Q(s){P.value=s,w.value=!0}async function W(){const s=P.value;if(!s)return;const e=s.key;r.value=r.value.filter(o=>o.key!==e),l.value===e&&(l.value=r.value[0]?.key||"",c.value=[],l.value&&f(l.value)),await B(e)?E("Processo excluído"):(r.value=[...r.value,s],$("Falha ao excluir. Tente novamente.")),w.value=!1,P.value=null}function X(){_.value=!0}function Y(){try{r.value.map(e=>e.key).forEach(e=>B(e)),localStorage.removeItem("pipeline_processes")}catch{}r.value=[],l.value="",c.value=[],f(""),_.value=!1}function ee(){m.value=!1,p.value=""}async function te(){if(l.value){if(!j()){const a=ge(p.value||l.value),d=(i=>{const v=new Set(I().map(y=>y.key));if(!v.has(i)||i===l.value)return i;let n=2;for(;v.has(`${i}-${n}`);)n++;return`${i}-${n}`})(a);if(d!==l.value){if(!ve(l.value,d).ok)return;l.value=d,f(d)}}const s=p.value||l.value,e=await pe(l.value,s);e&&(r.value=r.value.map(a=>a.key===l.value?{...a,name:s}:a));try{const a=(c.value||[]).map(d=>({id:d.id,title:d.title})),o=await me(l.value,a,c.value);if(Array.isArray(o)&&o.length){const d=o.map(i=>({id:i.id,title:i.title,slaDays:i.slaDays,color:i.color}));c.value=d;try{const i=`pipeline_stage_forms__${l.value}`,v=localStorage.getItem(i),n=v?JSON.parse(v)||{}:{},y={...n};for(let D=0;D<d.length;D++){const A=a[D]?.id,x=d[D]?.id;if(!(!A||!x||A===x)&&n[A]&&(y[x]=n[A],delete y[A],j()&&/^[a-fA-F0-9]{24}$/.test(x))){const ae=(y[x]||[]).map((q,se)=>({...q,order:se}));try{await ye(x,ae)}catch{}}}localStorage.setItem(i,JSON.stringify(y))}catch{}}e?E("Esteira salva"):J("Etapas salvas; falha ao renomear o processo"),m.value=!1}catch{$("Falha ao salvar etapas. Verifique a conexão.");return}}else m.value=!1}async function V(){if(j())try{const s=`pipeline_stage_forms__${l.value}`,e=localStorage.getItem(s),o={...e?JSON.parse(e)||{}:{}};for(const d of c.value||[]){const i=d?.id;if(!(!i||!/^[a-fA-F0-9]{24}$/.test(i)))try{const v=await fe(i);Array.isArray(v)&&(o[i]=v.map(n=>({id:n.id||String(Date.now()),label:n.label,type:n.type,required:!!n.required,placeholder:n.placeholder||"",options:Array.isArray(n.options)?n.options:[]})))}catch{}}localStorage.setItem(s,JSON.stringify(o))}catch{}}return le(l,async s=>{if(!s){c.value=[];return}const e=await U(s);c.value=Array.isArray(e)?e.map(o=>({id:o.id,title:o.title,slaDays:o.slaDays,color:o.color})):[],f(s);const a=r.value.find(o=>o.key===s);p.value=a?.name||s,await V()}),oe(async()=>{if(!l.value)return;const s=await U(l.value);c.value=Array.isArray(s)?s.map(e=>({id:e.id,title:e.title,slaDays:e.slaDays,color:e.color})):[],await V()}),l.value&&f(l.value),(s,e)=>(k(),g("div",be,[e[17]||(e[17]=t("header",{class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4"},[t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Configurações da Esteira"),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Gerencie processos e configurações da esteira ")])])],-1)),t("main",ke,[t("div",he,[t("div",we,[t("div",_e,[t("div",Ae,[e[9]||(e[9]=t("label",{class:"text-[12px] text-slate-300"},"Novo processo (nome)",-1)),z(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>S.value=a),class:"mt-1 bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"ex.: ConsorEquity"},null,512),[[T,S.value]])]),t("button",{class:"bg-orange-500 hover:bg-orange-600 text-white p-2 rounded-md text-sm disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center w-9 h-9",disabled:h.value,onClick:L,title:"Adicionar processo","aria-label":"Adicionar processo"},[h.value?(k(),g("i",Se)):(k(),g("i",Pe))],8,Ce),t("button",{class:"bg-slate-700 hover:bg-slate-600 text-white p-2 rounded-md text-sm w-9 h-9 flex items-center justify-center",onClick:X,title:"Zerar dados locais","aria-label":"Zerar dados locais"},[...e[10]||(e[10]=[t("i",{class:"fa-solid fa-rotate-left"},null,-1)])])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-[12px] text-slate-300"},"Processos",-1)),t("div",De,[(k(!0),g(re,null,ne(r.value,a=>(k(),g("div",{key:a.key,class:"flex items-center justify-between bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2"},[t("label",{class:"inline-flex items-center gap-2 cursor-pointer",onClick:o=>l.value=a.key},[t("input",{type:"radio",class:"accent-orange-500",checked:l.value===a.key},null,8,Ee),t("span",$e,M(a.name),1),t("span",Ve,"("+M(a.key)+")",1)],8,Me),t("div",Ne,[t("span",{class:K(["text-[11px]",a.active!==!1?"text-green-300":"text-slate-400"])},M(a.active!==!1?"Ativo":"Inativo"),3),t("button",{class:"p-2 text-slate-300 hover:text-white transition-colors",onClick:F(o=>G(a),["stop"]),title:a.active!==!1?"Desativar":"Ativar","aria-label":a.active!==!1?"Desativar":"Ativar"},[t("i",{class:K(a.active!==!1?"fa-solid fa-power-off text-sky-400":"fa-solid fa-play text-sky-400")},null,2)],8,Fe),t("button",{class:"p-2 text-slate-300 hover:text-sky-400 transition-colors",onClick:F(o=>H(a),["stop"]),title:"Editar","aria-label":"Editar"},[...e[11]||(e[11]=[t("i",{class:"fa-regular fa-pen-to-square"},null,-1)])],8,Ie),t("button",{class:"p-2 text-red-400 hover:text-red-300 transition-colors",onClick:F(o=>Q(a),["stop"]),title:"Excluir","aria-label":"Excluir"},[...e[12]||(e[12]=[t("i",{class:"fa-regular fa-trash-can"},null,-1)])],8,Ue)])]))),128))])])]),l.value?(k(),g("div",je,[C(R,{ref_key:"pipelineManagerRef",ref:O,stages:c.value,"onUpdate:stages":e[1]||(e[1]=a=>c.value=a),"pipeline-key":l.value},null,8,["stages","pipeline-key"])])):ie("",!0)])]),C(N,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),title:`Editar Pipeline: ${p.value}`,size:"xl"},{footer:b(()=>[t("div",{class:"flex items-center justify-end gap-2"},[t("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-md text-sm",onClick:ee}," Fechar "),t("button",{class:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-md text-sm",onClick:te}," Salvar ")])]),default:b(()=>[t("div",qe,[t("div",null,[e[14]||(e[14]=t("label",{class:"text-[12px] text-slate-300"},"Nome do processo",-1)),z(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"ex.: ConsorEquity"},null,512),[[T,p.value]])]),C(R,{ref_key:"pipelineManagerModalRef",ref:Z,stages:c.value,"onUpdate:stages":e[3]||(e[3]=a=>c.value=a),"pipeline-key":l.value},null,8,["stages","pipeline-key"])])]),_:1},8,["modelValue","title"]),C(N,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),title:"Confirmar Exclusão",size:"sm"},{footer:b(()=>[t("div",Ke,[t("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-md text-sm",onClick:e[5]||(e[5]=a=>w.value=!1)}," Cancelar "),t("button",{class:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-md text-sm",onClick:W}," Excluir ")])]),default:b(()=>[t("div",ze,[t("p",Te,' Tem certeza que deseja excluir o processo "'+M(P.value?.name)+'"? ',1),e[15]||(e[15]=t("p",{class:"text-sm text-slate-400"}," Esta ação não pode ser desfeita. ",-1))])]),_:1},8,["modelValue"]),C(N,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:"Zerar Dados Locais",size:"sm"},{footer:b(()=>[t("div",Re,[t("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-md text-sm",onClick:e[7]||(e[7]=a=>_.value=!1)}," Cancelar "),t("button",{class:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-md text-sm",onClick:Y}," Zerar Dados ")])]),default:b(()=>[e[16]||(e[16]=t("div",{class:"space-y-4"},[t("p",{class:"text-slate-300"}," Tem certeza que deseja zerar todos os dados locais? "),t("p",{class:"text-sm text-slate-400"}," Esta ação removerá todos os processos e configurações locais. ")],-1))]),_:1},8,["modelValue"])]))}};export{Xe as default};
