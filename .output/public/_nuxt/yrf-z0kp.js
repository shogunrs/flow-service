import{ai as A,r as a,y as B,g as F,D as $,c as n,h as H,a as t,l as c,t as _,q as k,H as O,d as C,a0 as L,a5 as U,o as i}from"./qcAyaCsh.js";const G=window.setInterval,J={class:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col"},W={class:"flex-1 flex flex-col items-center justify-center p-4"},K={class:"relative w-80 h-80 max-w-sm"},Q={key:0,class:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center z-20"},X={class:"text-center text-white"},Y={class:"text-sm"},Z={key:1,class:"absolute inset-0 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center z-20"},ee={class:"mt-6 text-center max-w-sm"},te={class:"text-white text-sm mb-4"},se={class:"flex justify-center space-x-4 mb-4"},ae={class:"flex items-center"},oe={class:"flex items-center"},le={class:"flex items-center"},ne=["disabled"],ie={key:1,disabled:"",class:"mt-6 bg-slate-600 text-white px-8 py-3 rounded-full text-lg font-semibold cursor-not-allowed"},re={key:3,class:"mt-4 p-3 bg-red-500 bg-opacity-20 border border-red-500 rounded-lg"},ce={class:"text-red-400 text-sm text-center"},fe={__name:"[userId]",setup(ue){const M=A(),I=L(),E=M.params.userId,l=a(),u=a(!0),P=a("Iniciando câmera..."),d=a(!1),v=a(!1),m=a(""),g=a(!1),x=a(!1),b=a(!1),o=a("Posicione seu rosto dentro do círculo");let f=null,p=null;const y=B(()=>g.value&&x.value&&b.value&&!u.value);F(async()=>{await j(),N()}),$(()=>{V()});async function j(){try{P.value="Acessando câmera...";const s={video:{facingMode:"user",width:{ideal:640},height:{ideal:640},frameRate:{ideal:30}}};f=await navigator.mediaDevices.getUserMedia(s),l.value&&(l.value.srcObject=f,await l.value.play()),u.value=!1,o.value="Mantenha o rosto dentro do círculo e aguarde"}catch(s){console.error("Camera error:",s),m.value="Não foi possível acessar a câmera. Verifique as permissões.",u.value=!1}}function N(){p=G(()=>{!u.value&&!d.value&&(g.value=Math.random()>.3,x.value=Math.random()>.2,b.value=Math.random()>.4,y.value?o.value="Perfeito! Clique em Capturar quando estiver pronto":g.value?x.value?b.value||(o.value="Mantenha o rosto estável"):o.value="Posicione seu rosto no centro do círculo":o.value="Melhore a iluminação do ambiente")},500)}async function R(){if(y.value){d.value=!0,o.value="Processando reconhecimento facial...";try{const s=document.createElement("canvas"),e=s.getContext("2d");s.width=l.value.videoWidth,s.height=l.value.videoHeight,e.drawImage(l.value,0,0);const h=await new Promise(w=>{s.toBlob(w,"image/jpeg",.8)});await new Promise(w=>setTimeout(w,2e3));const r=z(),q=await D();await S(r,q),v.value=!0,o.value="Reconhecimento facial realizado com sucesso!"}catch(s){console.error("Capture error:",s),m.value="Erro durante o processamento. Tente novamente."}finally{d.value=!1}}}async function S(s,e){const{$api:h}=U(),r=await h(`/api/v1/mobile/users/${E}/face-recognition/process`,{method:"POST",body:{faceEmbedding:s,location:e}});if(!r.success)throw new Error(r.error||"Erro no processamento")}function z(){const s=Array.from({length:128},()=>Math.random()*2-1);return JSON.stringify(s)}async function D(){return new Promise(s=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{const{latitude:h,longitude:r}=e.coords;s(`${h},${r}`)},()=>s(null),{timeout:5e3,enableHighAccuracy:!1}):s(null)})}function T(){I.push("/mobile/success")}function V(){f&&(f.getTracks().forEach(s=>s.stop()),f=null),p&&(clearInterval(p),p=null)}return(s,e)=>(i(),n("div",J,[e[9]||(e[9]=H('<div class="relative bg-slate-900/80 backdrop-blur-xl border-b border-slate-700/50 px-4 py-4 shadow-lg"><div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10"></div><div class="relative flex flex-col items-center"><div class="flex items-center gap-3 mb-2"><div class="p-2 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl shadow-lg"><i class="fa-solid fa-user-check text-white text-lg"></i></div><h1 class="text-xl font-bold text-white"> Reconhecimento Facial </h1></div><p class="text-sm text-slate-400 text-center"> Posicione seu rosto na área indicada </p></div></div>',1)),t("div",W,[t("div",K,[e[2]||(e[2]=t("div",{class:"absolute inset-0 border-4 border-dashed border-white rounded-full opacity-50 z-10"},null,-1)),t("video",{ref_key:"videoElement",ref:l,class:"w-full h-full object-cover rounded-full bg-slate-700",autoplay:"",muted:"",playsinline:""},null,512),u.value?(i(),n("div",Q,[t("div",X,[e[0]||(e[0]=t("i",{class:"fa-solid fa-spinner fa-spin text-3xl mb-2"},null,-1)),t("p",Y,_(P.value),1)])])):c("",!0),v.value?(i(),n("div",Z,[...e[1]||(e[1]=[t("i",{class:"fa-solid fa-check text-green-400 text-4xl"},null,-1)])])):c("",!0)]),t("div",ee,[t("p",te,_(o.value),1),t("div",se,[t("div",ae,[t("i",{class:k(["fa-solid fa-lightbulb mr-1",g.value?"text-green-400":"text-red-400"])},null,2),e[3]||(e[3]=t("span",{class:"text-xs text-slate-300"},"Iluminação",-1))]),t("div",oe,[t("i",{class:k(["fa-solid fa-user mr-1",x.value?"text-green-400":"text-red-400"])},null,2),e[4]||(e[4]=t("span",{class:"text-xs text-slate-300"},"Rosto",-1))]),t("div",le,[t("i",{class:k(["fa-solid fa-camera mr-1",b.value?"text-green-400":"text-red-400"])},null,2),e[5]||(e[5]=t("span",{class:"text-xs text-slate-300"},"Posição",-1))])])]),!d.value&&!v.value?(i(),n("button",{key:0,onClick:R,disabled:!O(y),class:"mt-6 bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white px-8 py-3 rounded-full text-lg font-semibold transition-colors"},[...e[6]||(e[6]=[t("i",{class:"fa-solid fa-camera mr-2"},null,-1),C(" Capturar ",-1)])],8,ne)):c("",!0),d.value?(i(),n("button",ie,[...e[7]||(e[7]=[t("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1),C(" Processando... ",-1)])])):c("",!0),v.value?(i(),n("button",{key:2,onClick:T,class:"mt-6 bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full text-lg font-semibold transition-colors"},[...e[8]||(e[8]=[t("i",{class:"fa-solid fa-check mr-2"},null,-1),C(" Continuar ",-1)])])):c("",!0),m.value?(i(),n("div",re,[t("p",ce,_(m.value),1)])):c("",!0)]),e[10]||(e[10]=t("div",{class:"bg-slate-800 px-4 py-3 text-center"},[t("p",{class:"text-xs text-slate-400"}," Suas informações são protegidas e criptografadas ")],-1))]))}};export{fe as default};
