import{e as ue,r as p,h as y,f as pe,c as v,o as g,a as e,m as L,n as X,t as $,p as h,y as O,E as ge,F as T,j as z,D as ee,d as M,G as ce,_ as oe,i as me,k as te,B as be,w as ae,b as ve,A as xe,K as ye,P as le}from"./CPKTtwfv.js";import{g as fe,a as se,b as Se,s as he,e as _e,h as we}from"./BFT2zYfe.js";import{isApiEnabled as W}from"./Dbx-Jqc8.js";const ke={class:"space-y-3"},Ce={class:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-3 flex items-center justify-between"},Ne={class:"flex items-center gap-2"},Ae={class:"text-white text-sm font-semibold"},Ve={class:"text-[11px] text-slate-300"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},De=["value"],Ie={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},Ue={class:"md:col-span-1"},Fe={class:"mt-1 flex items-center gap-2 flex-wrap"},Oe=["title","data-tip","onClick"],Te={class:"md:col-span-2"},Ee=["value"],qe={key:0,class:"text-[12px] text-slate-400"},ze={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},Me=["onUpdate:modelValue"],Pe=["onUpdate:modelValue"],Be=["value"],Je={class:"flex items-end gap-2"},Ke={class:"inline-flex items-center gap-2 text-[12px] text-slate-300"},je=["onUpdate:modelValue"],Le=["onClick"],Re={key:0,class:"grid grid-cols-1 gap-2"},Ge=["onUpdate:modelValue"],He={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-2"},Qe=["onUpdate:modelValue"],We=ue({__name:"StageFormBuilder",props:{modelValue:{type:Array,default:()=>[]},stageName:{type:String,default:""},stageId:{type:String,required:!0},stageSla:{type:Number,default:0},stageColor:{type:String,default:"sky"},stageStatus:{type:String,default:""}},emits:["update:modelValue","update:stageName","update:stageSla","update:stageColor","update:stageStatus"],setup(P,{emit:R}){const x=P,i=R,_=p((x.modelValue||[]).map(f));function d(a,s){try{return JSON.stringify(a)===JSON.stringify(s)}catch{return!1}}let E=!1;const w=p(x.stageName||""),S=p(String(x.stageSla??"")),k=p(x.stageColor||"sky"),D=p(x.stageStatus||""),q=p([]);y(()=>x.modelValue,a=>{E=!0,_.value=(a||[]).map(f),E=!1},{deep:!0}),y(()=>x.stageName,a=>{w.value=a||""}),y(()=>x.stageSla,a=>{S.value=String(a??"")}),y(()=>x.stageColor,a=>{k.value=a||"sky"}),y(()=>x.stageStatus,a=>{D.value=a||""}),y(_,a=>{if(E)return;const s=a.map(N);d(s,x.modelValue)||i("update:modelValue",s)},{deep:!0}),y(w,a=>i("update:stageName",a)),y(S,a=>i("update:stageSla",Number(a||0))),y(k,a=>i("update:stageColor",a||"sky")),y(D,a=>i("update:stageStatus",a||""));const G=[{value:"text",label:"Texto"},{value:"number",label:"Número"},{value:"date",label:"Data"},{value:"cpf",label:"CPF"},{value:"cnpj",label:"CNPJ"},{value:"rg",label:"RG"},{value:"cep",label:"CEP"},{value:"telefone",label:"Telefone"},{value:"endereco",label:"Endereço Completo"},{value:"select",label:"Lista (Select)"},{value:"file",label:"Arquivo"}];pe(async()=>{try{q.value=await fe()}catch{q.value=[]}});const H=[{name:"sky",ring:"bg-sky-500"},{name:"indigo",ring:"bg-indigo-500"},{name:"amber",ring:"bg-amber-500"},{name:"rose",ring:"bg-rose-500"},{name:"green",ring:"bg-green-500"},{name:"purple",ring:"bg-purple-500"},{name:"blue",ring:"bg-blue-500"},{name:"orange",ring:"bg-orange-500"},{name:"teal",ring:"bg-teal-500"},{name:"cyan",ring:"bg-cyan-500"},{name:"lime",ring:"bg-lime-500"},{name:"emerald",ring:"bg-emerald-500"},{name:"fuchsia",ring:"bg-fuchsia-500"},{name:"violet",ring:"bg-violet-500"},{name:"pink",ring:"bg-pink-500"},{name:"red",ring:"bg-red-500"},{name:"yellow",ring:"bg-yellow-500"},{name:"slate",ring:"bg-slate-500"},{name:"stone",ring:"bg-stone-500"},{name:"zinc",ring:"bg-zinc-500"}];function C(){_.value.push(f({id:String(Date.now()),label:"Novo Campo",type:"text",required:!1}))}function B(a){_.value.splice(a,1)}function f(a){return{id:a.id||String(Date.now()),label:a.label||"",type:a.type||"text",required:!!a.required,placeholder:a.placeholder||"",options:Array.isArray(a.options)?a.options:[],optionsText:Array.isArray(a.options)?a.options.join(", "):a.optionsText||""}}function N(a){return{id:a.id,label:a.label,type:a.type,required:!!a.required,placeholder:a.placeholder||"",options:a.type==="select"?(a.optionsText||"").split(",").map(s=>s.trim()).filter(Boolean):[]}}const A={sky:"bg-sky-500",indigo:"bg-indigo-500",amber:"bg-amber-500",rose:"bg-rose-500",green:"bg-green-500",purple:"bg-purple-500",blue:"bg-blue-500",orange:"bg-orange-500",teal:"bg-teal-500",cyan:"bg-cyan-500",lime:"bg-lime-500",emerald:"bg-emerald-500",fuchsia:"bg-fuchsia-500",violet:"bg-violet-500",pink:"bg-pink-500",red:"bg-red-500",yellow:"bg-yellow-500",slate:"bg-slate-500",stone:"bg-stone-500",zinc:"bg-zinc-500"};function V(a){return A[a]||"bg-sky-500"}return(a,s)=>{const I=ge("numeric");return g(),v("div",ke,[e("div",Ce,[e("div",Ne,[e("span",{class:X(["w-2 h-6 rounded-full",V(k.value)])},null,2),e("div",null,[e("div",Ae,$(w.value||"Nova Etapa"),1),e("div",Ve," SLA "+$(Number(S.value||0))+"d ",1)])]),s[3]||(s[3]=e("div",{class:"text-[11px] text-slate-400"},"Pré-visualização",-1))]),e("div",$e,[e("div",null,[s[4]||(s[4]=e("label",{class:"text-[12px] text-slate-300"},"Nome da Etapa",-1)),h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>w.value=o),class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: Documentação"},null,512),[[O,w.value]])]),e("div",null,[s[5]||(s[5]=e("label",{class:"text-[12px] text-slate-300"},"ID (somente leitura)",-1)),e("input",{value:P.stageId,disabled:"",class:"mt-1 w-full bg-slate-800/40 border border-slate-700/60 text-slate-400 rounded-md px-3 py-2 text-sm"},null,8,De)])]),e("div",Ie,[e("div",null,[s[6]||(s[6]=e("label",{class:"text-[12px] text-slate-300"},"SLA (dias)",-1)),h(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>S.value=o),type:"text",min:"0",class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},null,512),[[O,S.value],[I,{allowDecimal:!1,maxLength:3}]])]),e("div",Ue,[s[7]||(s[7]=e("label",{class:"text-[12px] text-slate-300"},"Cor da Coluna",-1)),e("div",Fe,[(g(),v(T,null,z(H,o=>e("button",{key:o.name,class:X(["w-7 h-7 rounded-full border border-slate-600 outline-none focus:ring-2 focus:ring-white/30 color-dot",[o.ring,k.value===o.name?"ring-2 ring-white/60 scale-110":"opacity-85"]]),title:o.name,"data-tip":o.name,onClick:J=>k.value=o.name},null,10,Oe)),64))])]),e("div",Te,[s[9]||(s[9]=e("label",{class:"text-[12px] text-slate-300"},"Status inicial",-1)),h(e("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>D.value=o),class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},[s[8]||(s[8]=e("option",{value:""},"(sem status)",-1)),(g(!0),v(T,null,z(q.value,o=>(g(),v("option",{key:o,value:o},$(o),9,Ee))),128))],512),[[ee,D.value]])])]),e("div",{class:"flex items-center justify-between mt-1"},[s[11]||(s[11]=e("div",{class:"text-[12px] text-slate-300"},"Campos do formulário",-1)),e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded-md text-xs",onClick:C},[...s[10]||(s[10]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),M("Novo Campo ",-1)])])]),_.value.length===0?(g(),v("div",qe," Nenhum campo adicionado. ")):L("",!0),(g(!0),v(T,null,z(_.value,(o,J)=>(g(),v("div",{key:o.id,class:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3 space-y-2"},[e("div",ze,[e("div",null,[s[12]||(s[12]=e("label",{class:"text-[12px] text-slate-300"},"Rótulo",-1)),h(e("input",{"onUpdate:modelValue":u=>o.label=u,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: CPF"},null,8,Me),[[O,o.label]])]),e("div",null,[s[13]||(s[13]=e("label",{class:"text-[12px] text-slate-300"},"Tipo",-1)),h(e("select",{"onUpdate:modelValue":u=>o.type=u,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},[(g(),v(T,null,z(G,u=>e("option",{key:u.value,value:u.value},$(u.label),9,Be)),64))],8,Pe),[[ee,o.type]])]),e("div",Je,[e("label",Ke,[h(e("input",{type:"checkbox","onUpdate:modelValue":u=>o.required=u,class:"accent-orange-500"},null,8,je),[[ce,o.required]]),s[14]||(s[14]=M(" Obrigatório ",-1))]),e("button",{class:"ml-auto text-red-400 hover:text-red-300 text-sm",onClick:u=>B(J)}," Remover ",8,Le)])]),o.type==="select"?(g(),v("div",Re,[e("div",null,[s[15]||(s[15]=e("label",{class:"text-[12px] text-slate-300"},"Opções (separadas por vírgula)",-1)),h(e("input",{"onUpdate:modelValue":u=>o.optionsText=u,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: Aprovado, Pendente, Reprovado"},null,8,Ge),[[O,o.optionsText]])])])):L("",!0),o.type==="text"||o.type==="number"?(g(),v("div",He,[e("div",null,[s[16]||(s[16]=e("label",{class:"text-[12px] text-slate-300"},"Placeholder",-1)),h(e("input",{"onUpdate:modelValue":u=>o.placeholder=u,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},null,8,Qe),[[O,o.placeholder]])])])):L("",!0)]))),128))])}}}),Xe=oe(We,[["__scopeId","data-v-3033a0f4"]]),Ye={class:"space-y-3"},Ze=["onDragstart","onDrop"],et=["onUpdate:modelValue"],tt={class:"flex items-center gap-2"},at={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300"},lt={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300"},st=["data-tip"],ot=["title"],rt=["onClick"],nt=["onClick"],it={key:0,class:"fixed bottom-4 right-4 z-[70] bg-slate-800 text-slate-100 px-3 py-2 rounded-md border border-slate-700 shadow"},dt={__name:"PipelineManager",props:{stages:{type:Array,default:()=>[]},pipelineKey:{type:String,default:"quotaequity"}},emits:["update:stages"],setup(P,{expose:R,emit:x}){const i=P,_=x,d=p(JSON.parse(JSON.stringify(i.stages||[])));function E(l){try{return JSON.parse(JSON.stringify(l))}catch{return l}}function w(l,t){try{return JSON.stringify(l)===JSON.stringify(t)}catch{return!1}}let S=!1;y(()=>i.stages,l=>{S=!0,d.value=E(l||[]),S=!1}),y(d,l=>{S||w(l,i.stages)||_("update:stages",l)},{deep:!0});function k(){const l=`temp_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return d.value.push({id:l,title:"Nova Etapa",slaDays:1,color:"sky"}),l}async function D(){const l=k();await le();const t=d.value.findIndex(r=>r.id===l);o(t>=0?t:d.value.length-1)}function q(l){d.value.splice(l,1)}const G={sky:"bg-sky-500",indigo:"bg-indigo-500",amber:"bg-amber-500",rose:"bg-rose-500",green:"bg-green-500",purple:"bg-purple-500",blue:"bg-blue-500",orange:"bg-orange-500",teal:"bg-teal-500",cyan:"bg-cyan-500",lime:"bg-lime-500",emerald:"bg-emerald-500",fuchsia:"bg-fuchsia-500",violet:"bg-violet-500",pink:"bg-pink-500",red:"bg-red-500",yellow:"bg-yellow-500",slate:"bg-slate-500",stone:"bg-stone-500",zinc:"bg-zinc-500"};function H(l){return G[l]||"bg-sky-500"}const C=p(!1),B=p(-1),f=p([]),N=p(""),A=p(0),V=p("sky"),a=p(""),s=p(""),I=me(()=>d.value[B.value]||null);async function o(l){B.value=l,C.value=!0,await le();const t=d.value[l];if(t){N.value=t.title||"",A.value=Number(t.slaDays||0),V.value=t.color||"sky",a.value=t.defaultStatus||"",s.value=String(t.title||"");const r=Q();if(f.value=r[t.id]||[],W()){let n=t.id;try{const m=await se(i.pipelineKey);if(Array.isArray(m)&&m.length&&!(typeof n=="string"&&/^[a-fA-F0-9]{24}$/.test(n)&&m.find(F=>F.id===n))){const F=m[l];if(F?.id)n=F.id;else{const j=m.find(de=>(de.title||"").trim()===s.value.trim());j?.id&&(n=j.id)}}}catch{}if(typeof n=="string"&&/^[a-fA-F0-9]{24}$/.test(n))try{const m=await Se(n);Array.isArray(m)&&m.length&&(f.value=m.map(b=>({id:b.id||String(Date.now()),label:b.label,type:b.type,required:!!b.required,placeholder:b.placeholder||"",options:Array.isArray(b.options)?b.options:[],optionsText:Array.isArray(b.options)?b.options.join(", "):""})))}catch{}}}else N.value="",A.value=0,V.value="sky",f.value=[]}function J(){C.value=!1}async function u(){const l=I.value;if(!l)return;l.title=N.value||l.title,l.slaDays=Number(A.value||0),l.color=V.value||"sky",l.defaultStatus=a.value||"";const t=Q();t[l.id]=f.value,re(t);try{if(W()){await he(i.pipelineKey,d.value);const r=await se(i.pipelineKey);let n=l.id;const c=r.find(b=>(b.title||"").trim()===(l.title||"").trim());if(c?.id&&(n=c.id),typeof n=="string"&&/^[a-fA-F0-9]{24}$/.test(n)){const b=(f.value||[]).map((F,j)=>({...F,order:j}));await _e(n,b)}}}catch(r){console.error("Error saving stage:",r)}C.value=!1}function Q(){try{const l=localStorage.getItem(`pipeline_stage_forms__${i.pipelineKey}`);if(l)return JSON.parse(l)||{}}catch{}return{}}function re(l){try{localStorage.setItem(`pipeline_stage_forms__${i.pipelineKey}`,JSON.stringify(l))}catch{}}function Y(l){try{const t=localStorage.getItem(`pipeline_stage_forms__${i.pipelineKey}`);if(!t)return 0;const n=(JSON.parse(t)||{})[l];return Array.isArray(n)?n.length:0}catch{return 0}}R({loadForms:Q});let U=-1;function ne(l,t){U=l,t.dataTransfer.effectAllowed="move"}async function ie(l,t){if(t.preventDefault(),U===-1||U===l)return;const r=d.value[U];if(d.value.splice(U,1),d.value.splice(l,0,r),W()){const n=d.value.map((c,m)=>({id:c.id,order:m}));try{await we(i.pipelineKey,n),Z("Ordem atualizada")}catch{Z("Erro ao atualizar ordem")}}U=-1}const K=p({show:!1,text:""});function Z(l){K.value={show:!0,text:l},setTimeout(()=>K.value.show=!1,2200)}return(l,t)=>(g(),v(T,null,[e("div",Ye,[t[11]||(t[11]=e("div",{class:"text-[12px] text-slate-300"}," Gerencie etapas e SLAs da esteira. ",-1)),e("div",null,[e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded-md text-xs",onClick:D},[...t[7]||(t[7]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),M("Nova Etapa ",-1)])])]),(g(!0),v(T,null,z(d.value,(r,n)=>(g(),v("div",{key:r.id,class:"flex items-center gap-3 p-2 rounded-md border border-slate-700/40 hover:border-slate-600/60 cursor-move",draggable:"true",onDragstart:c=>ne(n,c),onDragover:t[0]||(t[0]=be(()=>{},["prevent"])),onDrop:c=>ie(n,c)},[t[10]||(t[10]=e("div",{class:"flex items-center text-slate-400 cursor-grab active:cursor-grabbing"},[e("i",{class:"fa-solid fa-grip-vertical text-sm"})],-1)),h(e("input",{"onUpdate:modelValue":c=>r.title=c,class:"bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 flex-1 text-sm",placeholder:"Título da etapa"},null,8,et),[[O,r.title]]),e("div",tt,[e("span",at,[t[8]||(t[8]=e("i",{class:"fa-solid fa-stopwatch"},null,-1)),M(" "+$(Number(r.slaDays||0))+"d ",1)]),e("span",lt,[e("span",{class:X(["w-3 h-3 rounded-full border border-white/20 color-dot",H(r.color)]),"data-tip":r.color||"sky"},null,10,st)]),e("span",{class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300",title:`${Y(r.id)} campos`},[t[9]||(t[9]=e("i",{class:"fa-regular fa-rectangle-list"},null,-1)),M(" "+$(Y(r.id)),1)],8,ot)]),e("button",{class:"text-orange-400 hover:text-orange-300 text-sm",onClick:c=>o(n)}," Inputs ",8,rt),e("button",{class:"text-red-400 hover:text-red-300 text-sm",onClick:c=>q(n)}," Remover ",8,nt)],40,Ze))),128)),(g(),te(xe,{modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=r=>C.value=r),title:"Configurar Inputs da Etapa",size:"lg","z-index":60,key:`builder-${I.value?.id||"new"}`},{footer:ae(()=>[e("div",{class:"flex items-center justify-end gap-2"},[e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-md text-sm",onClick:J}," Cancelar "),e("button",{class:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-md text-sm",onClick:u}," Salvar ")])]),default:ae(()=>[ve(Xe,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=r=>f.value=r),"stage-id":I.value?.id||"",stageName:N.value,"onUpdate:stageName":t[2]||(t[2]=r=>N.value=r),stageSla:A.value,"onUpdate:stageSla":t[3]||(t[3]=r=>A.value=r),stageColor:V.value,"onUpdate:stageColor":t[4]||(t[4]=r=>V.value=r),stageStatus:a.value,"onUpdate:stageStatus":t[5]||(t[5]=r=>a.value=r)},null,8,["modelValue","stage-id","stageName","stageSla","stageColor","stageStatus"])]),_:1},8,["modelValue"]))]),(g(),te(ye,{to:"body"},[K.value.show?(g(),v("div",it,$(K.value.text),1)):L("",!0)]))],64))}},ct=oe(dt,[["__scopeId","data-v-bf92e6f2"]]);export{ct as P};
