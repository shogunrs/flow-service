import{isApiEnabled as f,apiFetch as m}from"./BH6je_ft.js";import{r as c}from"./qcAyaCsh.js";const o={id:"u-guest",roles:["guest"],name:"Guest",email:"",superUser:!1,organizationId:void 0,fotoPerfilUrl:null,profileImage:null,avatarUrl:null},a=c({...o});function g(e){if(!Array.isArray(e))return["guest"];const l=e.map(t=>typeof t=="string"?t.trim():"").filter(Boolean);return l.length?l:["guest"]}function i(e){return{id:e.id||a.value.id||o.id,name:e.name??a.value.name??o.name,email:e.email??a.value.email??o.email,superUser:e.superUser??a.value.superUser??o.superUser,organizationId:e.organizationId??a.value.organizationId??o.organizationId,roles:g(e.roles??a.value.roles??o.roles),fotoPerfilUrl:e.fotoPerfilUrl??a.value.fotoPerfilUrl??o.fotoPerfilUrl,profileImage:e.profileImage??a.value.profileImage??o.profileImage,avatarUrl:e.avatarUrl??e.fotoPerfilUrl??e.profileImage??a.value.avatarUrl??a.value.fotoPerfilUrl??a.value.profileImage??o.avatarUrl}}async function u(){if(!f())return;const e=typeof localStorage<"u"?localStorage.getItem("flow-auth-token"):null,l=typeof localStorage<"u"?localStorage.getItem("flow-auth-email"):null;if(!(!e||!l))try{const t=await m("/api/v1/users",{silent:!0,headers:{Authorization:`Bearer ${e}`}});if(!Array.isArray(t)||!t.length)return;const r=t.find(s=>typeof s?.email=="string"&&s.email.toLowerCase()===l.toLowerCase());if(!r)return;const n=i({id:r.id,name:r.name,email:r.email,roles:Array.isArray(r.roles)?r.roles:[],superUser:r.superUser===!0,organizationId:r.organizationId,fotoPerfilUrl:r.fotoPerfilUrl??r.profileImage??null,profileImage:r.profileImage??r.fotoPerfilUrl??null,avatarUrl:r.fotoPerfilUrl??r.profileImage??null});a.value=n;try{localStorage.setItem("current-user",JSON.stringify(n))}catch{}}catch(t){console.warn("[Flow] Falha ao atualizar usu√°rio atual via API",t)}}function v(){function e(r){const n=i(r);a.value=n;try{localStorage.setItem("current-user",JSON.stringify(n))}catch{}}async function l(){try{const r=localStorage.getItem("current-user");if(r){const n=JSON.parse(r);a.value=i(n)}else a.value={...o}}catch{a.value={...o}}await u()}async function t(){await u()}return{user:a,setUser:e,load:l,refresh:t}}export{v as u};
