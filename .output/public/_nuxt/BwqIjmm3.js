import{e as ue,r as g,G as f,g as pe,K as ge,c as v,o as c,a as e,l as W,q as Z,t as I,i as _,m as O,F as q,k as B,C as ae,d as P,U as ce,_ as re,y as me,J as le,j as be,w as se,b as ve,I as xe,O as ye,s as oe}from"./qcAyaCsh.js";import{f as fe}from"./CGbtcE1L.js";import{isApiEnabled as G}from"./BH6je_ft.js";import{f as Se,s as he}from"./BA3JyHsk.js";import{f as we,k as _e,m as ke,u as Ce,n as Ne}from"./3xuymguz.js";const Ae={class:"space-y-3"},Ve={class:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-3 flex items-center justify-between"},De={class:"flex items-center gap-2"},$e={class:"text-white text-sm font-semibold"},Ie={class:"text-[11px] text-slate-300"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},Ue=["value"],Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},Fe={class:"md:col-span-1"},Oe={class:"mt-1 flex items-center gap-2 flex-wrap"},qe=["title","data-tip","onClick"],ze={class:"md:col-span-2"},Me=["value"],Je={key:0,class:"text-[12px] text-slate-400"},Be={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},Pe=["onUpdate:modelValue"],Ke=["onUpdate:modelValue"],je=["value"],Le={class:"flex items-end gap-2"},Re={class:"inline-flex items-center gap-2 text-[12px] text-slate-300"},Ge=["onUpdate:modelValue"],We=["onClick"],He={key:0,class:"grid grid-cols-1 gap-2"},Qe=["onUpdate:modelValue"],Xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-2"},Ye=["onUpdate:modelValue"],Ze=ue({__name:"StageFormBuilder",props:{modelValue:{type:Array,default:()=>[]},stageName:{type:String,default:""},stageId:{type:String,required:!0},stageSla:{type:Number,default:0},stageColor:{type:String,default:"sky"},stageStatus:{type:String,default:""}},emits:["update:modelValue","update:stageName","update:stageSla","update:stageColor","update:stageStatus"],setup(K,{emit:H}){const x=K,d=H,k=g((x.modelValue||[]).map(y));function u(l,s){try{return JSON.stringify(l)===JSON.stringify(s)}catch{return!1}}let z=!1;const C=g(x.stageName||""),h=g(String(x.stageSla??"")),N=g(x.stageColor||"sky"),T=g(x.stageStatus||""),M=g([]);f(()=>x.modelValue,l=>{z=!0,k.value=(l||[]).map(y),z=!1},{deep:!0}),f(()=>x.stageName,l=>{C.value=l||""}),f(()=>x.stageSla,l=>{h.value=String(l??"")}),f(()=>x.stageColor,l=>{N.value=l||"sky"}),f(()=>x.stageStatus,l=>{T.value=l||""}),f(k,l=>{if(z)return;const s=l.map(V);u(s,x.modelValue)||d("update:modelValue",s)},{deep:!0}),f(C,l=>d("update:stageName",l)),f(h,l=>d("update:stageSla",Number(l||0))),f(N,l=>d("update:stageColor",l||"sky")),f(T,l=>d("update:stageStatus",l||""));const Q=[{value:"text",label:"Texto"},{value:"number",label:"Número"},{value:"date",label:"Data"},{value:"cpf",label:"CPF"},{value:"cnpj",label:"CNPJ"},{value:"rg",label:"RG"},{value:"cep",label:"CEP"},{value:"telefone",label:"Telefone"},{value:"endereco",label:"Endereço Completo"},{value:"select",label:"Lista (Select)"},{value:"file",label:"Arquivo"}];pe(async()=>{try{M.value=await fe()}catch{M.value=[]}});const X=[{name:"sky",ring:"bg-sky-500"},{name:"indigo",ring:"bg-indigo-500"},{name:"amber",ring:"bg-amber-500"},{name:"rose",ring:"bg-rose-500"},{name:"green",ring:"bg-green-500"},{name:"purple",ring:"bg-purple-500"},{name:"blue",ring:"bg-blue-500"},{name:"orange",ring:"bg-indigo-600"},{name:"teal",ring:"bg-teal-500"},{name:"cyan",ring:"bg-cyan-500"},{name:"lime",ring:"bg-lime-500"},{name:"emerald",ring:"bg-emerald-500"},{name:"fuchsia",ring:"bg-fuchsia-500"},{name:"violet",ring:"bg-violet-500"},{name:"pink",ring:"bg-pink-500"},{name:"red",ring:"bg-red-500"},{name:"yellow",ring:"bg-yellow-500"},{name:"slate",ring:"bg-slate-500"},{name:"stone",ring:"bg-stone-500"},{name:"zinc",ring:"bg-zinc-500"}];function A(){k.value.push(y({id:String(Date.now()),label:"Novo Campo",type:"text",required:!1}))}function j(l){k.value.splice(l,1)}function y(l){return{id:l.id||String(Date.now()),label:l.label||"",type:l.type||"text",required:!!l.required,placeholder:l.placeholder||"",options:Array.isArray(l.options)?l.options:[],optionsText:Array.isArray(l.options)?l.options.join(", "):l.optionsText||""}}function V(l){return{id:l.id,label:l.label,type:l.type,required:!!l.required,placeholder:l.placeholder||"",options:l.type==="select"?(l.optionsText||"").split(",").map(s=>s.trim()).filter(Boolean):[]}}const D={sky:"bg-sky-500",indigo:"bg-indigo-500",amber:"bg-amber-500",rose:"bg-rose-500",green:"bg-green-500",purple:"bg-purple-500",blue:"bg-blue-500",orange:"bg-indigo-600",teal:"bg-teal-500",cyan:"bg-cyan-500",lime:"bg-lime-500",emerald:"bg-emerald-500",fuchsia:"bg-fuchsia-500",violet:"bg-violet-500",pink:"bg-pink-500",red:"bg-red-500",yellow:"bg-yellow-500",slate:"bg-slate-500",stone:"bg-stone-500",zinc:"bg-zinc-500"};function $(l){return D[l]||"bg-sky-500"}return(l,s)=>{const U=ge("numeric");return c(),v("div",Ae,[e("div",Ve,[e("div",De,[e("span",{class:Z(["w-2 h-6 rounded-full",$(N.value)])},null,2),e("div",null,[e("div",$e,I(C.value||"Nova Etapa"),1),e("div",Ie," SLA "+I(Number(h.value||0))+"d ",1)])]),s[3]||(s[3]=e("div",{class:"text-[11px] text-slate-400"},"Pré-visualização",-1))]),e("div",Te,[e("div",null,[s[4]||(s[4]=e("label",{class:"text-[12px] text-slate-300"},"Nome da Etapa",-1)),_(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>C.value=r),class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: Documentação"},null,512),[[O,C.value]])]),e("div",null,[s[5]||(s[5]=e("label",{class:"text-[12px] text-slate-300"},"ID (somente leitura)",-1)),e("input",{value:K.stageId,disabled:"",class:"mt-1 w-full bg-slate-800/40 border border-slate-700/60 text-slate-400 rounded-md px-3 py-2 text-sm"},null,8,Ue)])]),e("div",Ee,[e("div",null,[s[6]||(s[6]=e("label",{class:"text-[12px] text-slate-300"},"SLA (dias)",-1)),_(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>h.value=r),type:"text",min:"0",class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},null,512),[[O,h.value],[U,{allowDecimal:!1,maxLength:3}]])]),e("div",Fe,[s[7]||(s[7]=e("label",{class:"text-[12px] text-slate-300"},"Cor da Coluna",-1)),e("div",Oe,[(c(),v(q,null,B(X,r=>e("button",{key:r.name,class:Z(["w-7 h-7 rounded-full border border-slate-600 outline-none focus:ring-2 focus:ring-white/30 color-dot",[r.ring,N.value===r.name?"ring-2 ring-white/60 scale-110":"opacity-85"]]),title:r.name,"data-tip":r.name,onClick:L=>N.value=r.name},null,10,qe)),64))])]),e("div",ze,[s[9]||(s[9]=e("label",{class:"text-[12px] text-slate-300"},"Status inicial",-1)),_(e("select",{"onUpdate:modelValue":s[2]||(s[2]=r=>T.value=r),class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},[s[8]||(s[8]=e("option",{value:""},"(sem status)",-1)),(c(!0),v(q,null,B(M.value,r=>(c(),v("option",{key:r,value:r},I(r),9,Me))),128))],512),[[ae,T.value]])])]),e("div",{class:"flex items-center justify-between mt-1"},[s[11]||(s[11]=e("div",{class:"text-[12px] text-slate-300"},"Campos do formulário",-1)),e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded-md text-xs",onClick:A},[...s[10]||(s[10]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),P("Novo Campo ",-1)])])]),k.value.length===0?(c(),v("div",Je," Nenhum campo adicionado. ")):W("",!0),(c(!0),v(q,null,B(k.value,(r,L)=>(c(),v("div",{key:r.id,class:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3 space-y-2"},[e("div",Be,[e("div",null,[s[12]||(s[12]=e("label",{class:"text-[12px] text-slate-300"},"Rótulo",-1)),_(e("input",{"onUpdate:modelValue":p=>r.label=p,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: CPF"},null,8,Pe),[[O,r.label]])]),e("div",null,[s[13]||(s[13]=e("label",{class:"text-[12px] text-slate-300"},"Tipo",-1)),_(e("select",{"onUpdate:modelValue":p=>r.type=p,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},[(c(),v(q,null,B(Q,p=>e("option",{key:p.value,value:p.value},I(p.label),9,je)),64))],8,Ke),[[ae,r.type]])]),e("div",Le,[e("label",Re,[_(e("input",{type:"checkbox","onUpdate:modelValue":p=>r.required=p,class:"accent-indigo-500"},null,8,Ge),[[ce,r.required]]),s[14]||(s[14]=P(" Obrigatório ",-1))]),e("button",{class:"ml-auto text-red-400 hover:text-red-300 text-sm",onClick:p=>j(L)}," Remover ",8,We)])]),r.type==="select"?(c(),v("div",He,[e("div",null,[s[15]||(s[15]=e("label",{class:"text-[12px] text-slate-300"},"Opções (separadas por vírgula)",-1)),_(e("input",{"onUpdate:modelValue":p=>r.optionsText=p,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm",placeholder:"Ex.: Aprovado, Pendente, Reprovado"},null,8,Qe),[[O,r.optionsText]])])])):W("",!0),r.type==="text"||r.type==="number"?(c(),v("div",Xe,[e("div",null,[s[16]||(s[16]=e("label",{class:"text-[12px] text-slate-300"},"Placeholder",-1)),_(e("input",{"onUpdate:modelValue":p=>r.placeholder=p,class:"mt-1 w-full bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 text-sm"},null,8,Ye),[[O,r.placeholder]])])])):W("",!0)]))),128))])}}}),et=re(Ze,[["__scopeId","data-v-20b0a6cd"]]),tt={class:"space-y-3"},at=["onDragstart","onDrop"],lt=["onUpdate:modelValue"],st={class:"flex items-center gap-2"},ot={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300"},rt={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300"},it=["data-tip"],nt=["title"],dt=["onClick"],ut=["onClick"],pt={key:0,class:"fixed bottom-4 right-4 z-[70] bg-slate-800 text-slate-100 px-3 py-2 rounded-md border border-slate-700 shadow"},gt={__name:"PipelineManager",props:{stages:{type:Array,default:()=>[]},pipelineKey:{type:String,default:"quotaequity"}},emits:["update:stages"],setup(K,{expose:H,emit:x}){const d=K,k=x,u=g(JSON.parse(JSON.stringify(d.stages||[])));function z(t){try{return JSON.parse(JSON.stringify(t))}catch{return t}}function C(t,a){try{return JSON.stringify(t)===JSON.stringify(a)}catch{return!1}}let h=!1;f(()=>d.stages,t=>{h=!0,u.value=z(t||[]),h=!1}),f(u,t=>{h||C(t,d.stages)||k("update:stages",t)},{deep:!0});function N(){const t=`temp_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return u.value.push({id:t,title:"Nova Etapa",slaDays:1,color:"sky"}),t}async function T(){const t=N();await oe();const a=u.value.findIndex(o=>o.id===t);r(a>=0?a:u.value.length-1)}async function M(t){const a=u.value[t];if(!a)return;if(u.value.splice(t,1),!(a.id&&(a.id.startsWith("temp_")||a.id.match(/^\d+$/)))&&G())try{await _e(d.pipelineKey,a.id),R("Estágio removido com sucesso!")}catch(b){console.error("Error deleting stage:",b),u.value.splice(t,0,a),R("Erro ao remover estágio. Tente novamente.","error")}const i=J();i[a.id]&&(delete i[a.id],Y(i))}const Q={sky:"bg-sky-500",indigo:"bg-indigo-500",amber:"bg-amber-500",rose:"bg-rose-500",green:"bg-green-500",purple:"bg-purple-500",blue:"bg-blue-500",orange:"bg-indigo-600",teal:"bg-teal-500",cyan:"bg-cyan-500",lime:"bg-lime-500",emerald:"bg-emerald-500",fuchsia:"bg-fuchsia-500",violet:"bg-violet-500",pink:"bg-pink-500",red:"bg-red-500",yellow:"bg-yellow-500",slate:"bg-slate-500",stone:"bg-stone-500",zinc:"bg-zinc-500"};function X(t){return Q[t]||"bg-sky-500"}const A=g(!1),j=g(-1),y=g([]),V=g(""),D=g(0),$=g("sky"),l=g(""),s=g(""),U=me(()=>u.value[j.value]||null);async function r(t){j.value=t,A.value=!0,await oe();const a=u.value[t];if(a){V.value=a.title||"",D.value=Number(a.slaDays||0),$.value=a.color||"sky",l.value=a.defaultStatus||"",s.value=String(a.title||"");const o=J();if(y.value=o[a.id]||[],G()){let i=a.id;try{const n=await we(d.pipelineKey);if(Array.isArray(n)&&n.length&&!(typeof i=="string"&&/^[a-fA-F0-9]{24}$/.test(i)&&n.find(S=>S.id===i))){const S=n[t];if(S?.id)i=S.id;else{const w=n.find(de=>(de.title||"").trim()===s.value.trim());w?.id&&(i=w.id)}}}catch{}if(typeof i=="string"&&/^[a-fA-F0-9]{24}$/.test(i))try{const n=await Se(i);Array.isArray(n)&&n.length&&(y.value=n.map(m=>({id:m.id||String(Date.now()),label:m.label,type:m.type,required:!!m.required,placeholder:m.placeholder||"",options:Array.isArray(m.options)?m.options:[],optionsText:Array.isArray(m.options)?m.options.join(", "):""})))}catch{}}}else V.value="",D.value=0,$.value="sky",y.value=[]}function L(){A.value=!1}async function p(){const t=U.value;if(!t)return;t.title=V.value||t.title,t.slaDays=Number(D.value||0),t.color=$.value||"sky",t.defaultStatus=l.value||"";const a=J();a[t.id]=y.value,Y(a);try{if(G()){let o=t.id;if(t.id&&(t.id.startsWith("temp_")||t.id.match(/^\d+$/))){const n={title:t.title,slaDays:t.slaDays,color:t.color,defaultStatus:t.defaultStatus},m=await ke(d.pipelineKey,n);if(m?.id){o=m.id;const S=t.id;t.id=o;const w=J();w[S]?(w[o]=w[S],delete w[S]):w[o]=y.value,Y(w)}}else{const n={title:t.title,slaDays:t.slaDays,color:t.color,defaultStatus:t.defaultStatus};await Ce(d.pipelineKey,t.id,n)}if(typeof o=="string"&&/^[a-fA-F0-9]{24}$/.test(o)){const n=(y.value||[]).map((m,S)=>({...m,order:S}));await he(o,n)}R("Estágio salvo com sucesso!")}}catch(o){console.error("Error saving stage:",o),R("Erro ao salvar estágio. Tente novamente.","error")}A.value=!1}function J(){try{const t=localStorage.getItem(`pipeline_stage_forms__${d.pipelineKey}`);if(t)return JSON.parse(t)||{}}catch{}return{}}function Y(t){try{localStorage.setItem(`pipeline_stage_forms__${d.pipelineKey}`,JSON.stringify(t))}catch{}}function ee(t){try{const a=localStorage.getItem(`pipeline_stage_forms__${d.pipelineKey}`);if(!a)return 0;const i=(JSON.parse(a)||{})[t];return Array.isArray(i)?i.length:0}catch{return 0}}H({loadForms:J});let E=-1;function ie(t,a){E=t,a.dataTransfer.effectAllowed="move"}async function ne(t,a){if(a.preventDefault(),E===-1||E===t)return;const o=u.value[E];if(u.value.splice(E,1),u.value.splice(t,0,o),G()){const i=u.value.map((b,n)=>({id:b.id,order:n}));try{await Ne(d.pipelineKey,i),te("Ordem atualizada")}catch{te("Erro ao atualizar ordem")}}E=-1}const F=g({show:!1,text:""});function te(t){F.value={show:!0,text:t},setTimeout(()=>F.value.show=!1,2200)}function R(t,a="success"){F.value={show:!0,text:t},setTimeout(()=>F.value.show=!1,2200)}return(t,a)=>(c(),v(q,null,[e("div",tt,[a[11]||(a[11]=e("div",{class:"text-[12px] text-slate-300"}," Gerencie etapas e SLAs da esteira. ",-1)),e("div",null,[e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded-md text-xs",onClick:T},[...a[7]||(a[7]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),P("Nova Etapa ",-1)])])]),(c(!0),v(q,null,B(u.value,(o,i)=>(c(),v("div",{key:o.id,class:"flex items-center gap-3 p-2 rounded-md border border-slate-700/40 hover:border-slate-600/60 cursor-move",draggable:"true",onDragstart:b=>ie(i,b),onDragover:a[0]||(a[0]=be(()=>{},["prevent"])),onDrop:b=>ne(i,b)},[a[10]||(a[10]=e("div",{class:"flex items-center text-slate-400 cursor-grab active:cursor-grabbing"},[e("i",{class:"fa-solid fa-grip-vertical text-sm"})],-1)),_(e("input",{"onUpdate:modelValue":b=>o.title=b,class:"bg-slate-800/70 border border-slate-700/60 text-slate-200 rounded-md px-3 py-2 flex-1 text-sm",placeholder:"Título da etapa"},null,8,lt),[[O,o.title]]),e("div",st,[e("span",ot,[a[8]||(a[8]=e("i",{class:"fa-solid fa-stopwatch"},null,-1)),P(" "+I(Number(o.slaDays||0))+"d ",1)]),e("span",rt,[e("span",{class:Z(["w-3 h-3 rounded-full border border-white/20 color-dot",X(o.color)]),"data-tip":o.color||"sky"},null,10,it)]),e("span",{class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-slate-800 border border-slate-700 text-slate-300",title:`${ee(o.id)} campos`},[a[9]||(a[9]=e("i",{class:"fa-regular fa-rectangle-list"},null,-1)),P(" "+I(ee(o.id)),1)],8,nt)]),e("button",{class:"text-indigo-400 hover:text-indigo-300 text-sm",onClick:b=>r(i)}," Inputs ",8,dt),e("button",{class:"text-red-400 hover:text-red-300 text-sm",onClick:b=>M(i)}," Remover ",8,ut)],40,at))),128)),(c(),le(xe,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=o=>A.value=o),title:"Configurar Inputs da Etapa",size:"lg","z-index":60,key:`builder-${U.value?.id||"new"}`},{footer:se(()=>[e("div",{class:"flex items-center justify-end gap-2"},[e("button",{class:"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-md text-sm",onClick:L}," Cancelar "),e("button",{class:"bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:p}," Salvar ")])]),default:se(()=>[ve(et,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=o=>y.value=o),"stage-id":U.value?.id||"",stageName:V.value,"onUpdate:stageName":a[2]||(a[2]=o=>V.value=o),stageSla:D.value,"onUpdate:stageSla":a[3]||(a[3]=o=>D.value=o),stageColor:$.value,"onUpdate:stageColor":a[4]||(a[4]=o=>$.value=o),stageStatus:l.value,"onUpdate:stageStatus":a[5]||(a[5]=o=>l.value=o)},null,8,["modelValue","stage-id","stageName","stageSla","stageColor","stageStatus"])]),_:1},8,["modelValue"]))]),(c(),le(ye,{to:"body"},[F.value.show?(c(),v("div",pt,I(F.value.text),1)):W("",!0)]))],64))}},yt=re(gt,[["__scopeId","data-v-39ff4e72"]]);export{yt as P};
