import{_ as q,E as B,r as x,y as p,G as $,Z as de,c as f,o as n,a as s,l as y,i as M,q as w,v as P,t as k,d as H,F as K,k as Y,J as Q,e as fe,a3 as pe,g as me,b as j,D as he,Q as ve,aj as ge}from"./qcAyaCsh.js";/* empty css        */import{isApiEnabled as be,apiFetch as xe,getApiBase as ye}from"./BH6je_ft.js";import{u as we}from"./BlnrnVG4.js";import{_ as Ce}from"./DMU8Ws14.js";import"./CV9EyYCX.js";const ke={class:"relative"},Ae=["title"],Se={key:1,class:"pointer-events-none absolute right-3 top-2.5 w-1.5 h-1.5 rounded-full bg-white/80 shadow-[0_0_12px_rgba(255,255,255,0.55)]"},_e={key:2,class:"bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full"},Ie={key:0,class:"absolute left-full top-1/2 transform -translate-y-1/2 ml-2 z-50"},$e={class:"bg-slate-800 text-white text-sm px-2 py-1 rounded shadow-lg whitespace-nowrap"},Ue={__name:"SidebarItem",props:{item:{type:Object,required:!0},isActive:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},isChild:{type:Boolean,default:!1}},emits:["click","fetch-esteira"],setup(o,{emit:h}){const r=o,c=h,u=B(),m=x(!1),t=x(!1);let d=null;const a=p(()=>r.item.children&&r.item.children.length>0);function U(){if(r.item.path==="/esteira"&&c("fetch-esteira"),r.item.onClick&&typeof r.item.onClick=="function"){r.item.onClick();return}a.value&&!r.collapsed?t.value=!t.value:c("click",r.item)}function N(v){c("click",v)}function i(v){return v==="/"?u.path==="/":u.path.startsWith(v)}function _(){r.collapsed&&(d=setTimeout(()=>{m.value=!0},500))}function I(){d&&(clearTimeout(d),d=null),m.value=!1}return $(()=>r.isActive,v=>{v&&a.value&&(t.value=!0)}),$(()=>u.path,v=>{a.value&&r.item.children.some(C=>C.path==="/"?v==="/":v.startsWith(C.path))&&(t.value=!0)},{immediate:!0}),(v,g)=>{const C=de("SidebarItem",!0);return n(),f("div",ke,[s("button",{onClick:U,onMouseenter:_,onMouseleave:I,class:w(["w-full flex items-center gap-3 px-3 py-1.5 text-sm rounded-2xl transition-all duration-200 relative overflow-hidden border border-transparent",o.isActive?"text-slate-100":"text-slate-300 hover:text-white hover:bg-white/5 hover:border-white/10",o.collapsed?"justify-center":""]),title:o.collapsed?o.item.label:o.item.description},[s("i",{class:w([o.item.icon,"w-5 flex-shrink-0",o.isActive?"text-slate-100":"text-slate-300"])},null,2),M(s("span",{class:"flex-1 text-left truncate transition-opacity duration-300"},k(o.item.label),513),[[P,!o.collapsed]]),a.value&&!o.collapsed?(n(),f("i",{key:0,class:w(["fa-solid text-xs transition-transform",t.value?"fa-chevron-down":"fa-chevron-right"])},null,2)):y("",!0),o.isChild&&o.isActive?(n(),f("span",Se)):y("",!0),o.item.badge&&!o.collapsed?(n(),f("span",_e,k(o.item.badge),1)):y("",!0)],42,Ae),o.collapsed&&m.value?(n(),f("div",Ie,[s("div",$e,[H(k(o.item.label)+" ",1),g[0]||(g[0]=s("div",{class:"absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-slate-800"},null,-1))])])):y("",!0),a.value&&!o.collapsed?(n(),f("div",{key:1,class:w(["mt-1 ml-8 space-y-1 overflow-hidden transition-all duration-300",t.value?"max-h-96 opacity-100":"max-h-0 opacity-0"])},[(n(!0),f(K,null,Y(o.item.children,S=>(n(),Q(C,{key:S.path,item:S,"is-active":i(S.path),collapsed:!1,"is-child":!0,onClick:D=>N(S)},null,8,["item","is-active","onClick"]))),128))],2)):y("",!0)])}}},L=q(Ue,[["__scopeId","data-v-c4ee104e"]]),A=x([]),T=x(!1),V=x(null),O="esteira-processes",z="esteira-processes-timestamp",Ee=300*1e3,Z=()=>{const o=()=>{if(typeof window>"u")return!1;const t=localStorage.getItem(O),d=localStorage.getItem(z);return t&&d&&Date.now()-parseInt(d)<Ee?(A.value=JSON.parse(t),console.log("🗄️ Processos carregados do cache"),!0):!1},h=t=>{typeof window>"u"||(localStorage.setItem(O,JSON.stringify(t)),localStorage.setItem(z,Date.now().toString()))},r=()=>{typeof window>"u"||(localStorage.removeItem(O),localStorage.removeItem(z),A.value=[],console.log("🧹 Cache de processos limpo"))},c=async()=>{T.value=!0,V.value=null;try{if(!be()){A.value=[];return}const t=typeof localStorage<"u"?localStorage.getItem("flow-auth-token"):null,d={"Content-Type":"application/json",Accept:"application/json"};t&&(d.Authorization=`Bearer ${t}`),console.log("🔄 Buscando processos da API: /api/v1/processes");const a=await xe("/api/v1/processes",{headers:d,silent:!0});console.log("📦 Resposta da API:",a),console.log("📦 Tipo da resposta:",typeof a),console.log("📦 É array?",Array.isArray(a)),Array.isArray(a)&&a.length>0&&(console.log("📦 Primeiro item:",a[0]),console.log("📦 Propriedades do primeiro item:",Object.keys(a[0]||{}))),Array.isArray(a)?(A.value=a,h(a),console.log(`✅ ${a.length} processos carregados e salvos no cache`)):(console.warn("⚠️ API não retornou um array:",a),A.value=[])}catch(t){console.error("❌ Erro ao buscar processos:",t),V.value="Erro ao carregar processos",A.value=[]}finally{T.value=!1}},u=p(()=>A.value.filter(t=>t.active===!0)),m=p(()=>u.value.map(t=>({label:t.name,path:`/esteira/${t.key}`,icon:"fa-solid fa-stream",description:`Esteira do processo ${t.name}`})));return{processes:A,activeProcesses:u,processMenuItems:m,loading:T,error:V,fetchProcesses:c,clearCache:r,loadFromCache:o}},Me={class:"sidebar-container"},Pe={class:"flex flex-col h-full"},je={class:"px-4 pt-6 pb-5 border-b border-slate-900/70"},Be=["src"],Ne={key:1,class:"w-full h-full flex items-center justify-center text-sm font-semibold text-indigo-200"},Te={class:"flex-1 min-w-0"},Ve={class:"text-sm font-semibold text-slate-100 truncate"},Oe={class:"text-xs text-indigo-200/80 font-medium uppercase tracking-wide"},ze={class:"text-[11px] text-slate-400 truncate"},De=["title"],Fe={class:"mt-4 flex items-center gap-2 text-[11px] text-slate-400"},We={key:0,class:"truncate"},Ge={class:"flex-1 px-3 py-6 space-y-2 overflow-y-auto"},Re={class:"px-4 pb-5 pt-4 border-t border-slate-900/70 backdrop-blur-sm"},Je=["title"],Le={class:"transition-opacity duration-300"},qe=fe({__name:"Sidebar",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","collapsed"],setup(o,{emit:h}){const r=o,c=h,u=B(),m=pe(),{user:t,load:d}=we(),a=p(()=>t.value||{}),U=ye()?.replace(/\/$/,"")||"",N=p(()=>_.value.length===0),i=x(!1);x(!1),x([]),x(!1);const{processMenuItems:_,fetchProcesses:I,loading:v}=Z();me(async()=>{const e=localStorage.getItem("sidebar-collapsed");e!==null&&(i.value=JSON.parse(e),c("collapsed",i.value)),d(),N.value&&await I()}),$(()=>u.path,async e=>{e&&e.startsWith("/esteira")&&await I()},{immediate:!0});const g=p({get:()=>r.modelValue,set:e=>c("update:modelValue",e)}),C={super:"Super Usuário",admin:"Administrador",manager:"Gerente",analyst:"Analista",user:"Usuário",viewer:"Visualizador",guest:"Convidado"},S=p(()=>(Array.isArray(a.value?.roles)?a.value.roles:[]).map(l=>typeof l=="string"?l.trim().toLowerCase():"").filter(Boolean)),D=p(()=>S.value[0]||null),X=p(()=>{const l=(a.value?.name||"Usuário").trim().split(/\s+/);if(!l.length)return"Usuário";const b=l[0];return b?b.charAt(0).toUpperCase()+b.slice(1):"Usuário"}),ee=p(()=>a.value?.email||"sem-email"),te=p(()=>{if(a.value?.superUser)return C.super;const e=D.value;return e?C[e]||e:"Acesso Básico"}),F=p(()=>a.value?.superUser?[C.super]:S.value.map(e=>C[e]||e).slice(0,3)),se=e=>{if(!e||typeof e!="string")return"";const l=e.trim();return l?/^(https?:|data:|blob:)/i.test(l)||!U?l:`${U}${l.startsWith("/")?"":"/"}${l}`:""},W=p(()=>{const e=[a.value?.avatarUrl,a.value?.fotoPerfilUrl,a.value?.profileImage];for(const l of e){const b=se(typeof l=="string"?l:"");if(b)return b}return""}),ae=p(()=>{const l=(a.value?.name||"Usuário").trim().split(/\s+/);return l.length&&l.slice(0,2).map(ue=>ue[0]?.toUpperCase()).join("")||"U"}),oe=p(()=>[{label:"Dashboard",path:"/",icon:"fa-solid fa-home",description:"Visão geral do sistema"},{label:"Esteira",path:"/esteira",icon:"fa-solid fa-sitemap",description:"Gerenciar fluxos de trabalho",children:v.value?[{label:"Carregando...",path:"/esteira/loading",icon:"fa-solid fa-spinner fa-spin",description:"Carregando processos"}]:_.value.length>0?_.value:[{label:"Nenhum processo ativo",path:"/esteira/empty",icon:"fa-solid fa-info-circle",description:"Nenhum processo ativo encontrado"}]},{label:"Cadastro de Leads",path:"/leads",icon:"fa-solid fa-address-card",description:"Gerencie leads e qualificações"},{label:"Meu Perfil",path:"/profile",icon:"fa-solid fa-user",description:"Editar informações do perfil"},{label:"Configurações",path:"/admin",icon:"fa-solid fa-cog",description:"Configurações do sistema",roles:["admin"],children:[{label:"Usuários",path:"/admin/users",icon:"fa-solid fa-users",description:"Gerenciar usuários"},{label:"Esteira",path:"/admin/pipeline",icon:"fa-solid fa-sitemap",description:"Gerenciar pipeline"},{label:"Monitoramento",path:"/admin/settings/system-health",icon:"fa-solid fa-heart-pulse",description:"Central de monitoramento e alertas"},{label:"Status",path:"/admin/settings/status",icon:"fa-solid fa-tags",description:"Gerenciar status do sistema"},{label:"Notificações",path:"/admin/notifications",icon:"fa-solid fa-bell",description:"Gerenciar notificações"},{label:"Centro IA",path:"/admin/settings/ia",icon:"fa-solid fa-robot",description:"Centro de treinamento de IA"}]}]),G={label:"Configurações",path:"/settings",icon:"fa-solid fa-gear",description:"Configurações da conta"};function le(e){return e==="/"?u.path==="/":u.path.startsWith(e)}async function R(e){e.children&&e.children.length>0&&i.value&&(i.value=!1,localStorage.setItem("sidebar-collapsed",JSON.stringify(i.value)),c("collapsed",i.value)),e?.path&&e.path!=="/esteira"&&m.push(e.path),g.value&&E()}async function ie(){console.log("🎯 Clicou no ícone da Esteira - buscando processos..."),await I(),console.log("✅ Processos atualizados:",_.value)}async function re(){g.value=!0,await I()}function E(){g.value=!1}function ne(){R(G)}function ce(){try{localStorage.removeItem("flow-auth-token"),localStorage.removeItem("flow-auth-email")}catch(e){console.warn("[Flow] Falha ao limpar tokens",e)}m.push("/")}function J(){i.value=!i.value,localStorage.setItem("sidebar-collapsed",JSON.stringify(i.value)),c("collapsed",i.value)}return $(()=>u.path,()=>{g.value&&E()}),(e,l)=>(n(),f("div",Me,[g.value?(n(),f("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden",onClick:E})):y("",!0),s("nav",{class:w(["fixed top-0 left-0 h-screen bg-gradient-to-b from-slate-950 via-slate-900/95 to-slate-950/90 border-r border-slate-900/60 backdrop-blur-xl transform transition-all duration-300 ease-in-out z-[100]","lg:translate-x-0",i.value?"w-16":"w-64",g.value?"translate-x-0":"-translate-x-full lg:translate-x-0"])},[s("div",Pe,[s("div",je,[s("div",{class:w(["flex items-center gap-3",{"justify-center":i.value}])},[s("div",{class:w(["relative flex-shrink-0 overflow-hidden rounded-2xl ring-2 ring-indigo-500/40 shadow-lg shadow-indigo-500/10 bg-slate-900/70",i.value?"w-10 h-10 rounded-full cursor-pointer mx-auto":"w-12 h-12"]),onClick:l[0]||(l[0]=b=>i.value&&J())},[W.value?(n(),f("img",{key:0,src:W.value,alt:"Avatar",class:"w-full h-full object-cover"},null,8,Be)):(n(),f("div",Ne,k(ae.value),1))],2),M(s("div",Te,[s("p",Ve,k(X.value),1),s("p",Oe,k(te.value),1),s("p",ze,k(ee.value),1)],512),[[P,!i.value]]),i.value?y("",!0):(n(),f("button",{key:0,onClick:J,class:"hidden lg:inline-flex items-center justify-center w-9 h-9 rounded-xl bg-slate-900/60 text-slate-400 hover:text-white hover:bg-slate-800 transition-colors",title:i.value?"Expandir sidebar":"Recolher sidebar"},[s("i",{class:w(i.value?"fa-solid fa-chevron-right":"fa-solid fa-chevron-left")},null,2)],8,De)),g.value?(n(),f("button",{key:1,onClick:E,class:"lg:hidden inline-flex items-center justify-center w-9 h-9 rounded-xl bg-slate-900/60 text-slate-300 hover:text-white"},[...l[1]||(l[1]=[s("i",{class:"fa-solid fa-times"},null,-1)])])):y("",!0)],2),M(s("div",Fe,[l[2]||(l[2]=s("span",{class:"inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-slate-900/70 border border-slate-800/70 uppercase tracking-wide"},[s("span",{class:"w-1.5 h-1.5 rounded-full bg-emerald-400"}),H(" Online ")],-1)),F.value.length?(n(),f("span",We,k(F.value.join(" • ")),1)):y("",!0)],512),[[P,!i.value]])]),s("div",Ge,[(n(!0),f(K,null,Y(oe.value,b=>(n(),Q(L,{key:b.path,item:b,"is-active":le(b.path),collapsed:i.value,onClick:R,onFetchEsteira:ie},null,8,["item","is-active","collapsed"]))),128))]),s("div",Re,[j(L,{item:G,"is-active":!1,collapsed:i.value,onClick:ne},null,8,["collapsed"]),s("button",{onClick:ce,class:w(["w-full mt-2 flex items-center gap-3 px-3 py-2 text-slate-300 hover:text-white hover:bg-slate-800/70 rounded-xl transition-colors text-sm",i.value?"justify-center":"justify-start"]),title:i.value?"Sair":""},[l[3]||(l[3]=s("i",{class:"fa-solid fa-arrow-right-from-bracket w-5"},null,-1)),M(s("span",Le,"Sair",512),[[P,!i.value]])],10,Je)])])],2),g.value?y("",!0):(n(),f("button",{key:1,onClick:re,class:"fixed top-4 left-4 z-[110] lg:hidden p-2 rounded-xl bg-slate-900/90 text-white hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/40"},[...l[4]||(l[4]=[s("i",{class:"fa-solid fa-bars text-lg"},null,-1)])]))]))}}),He=q(qe,[["__scopeId","data-v-6e15bda7"]]),Ke=()=>{const o=B(),{clearCache:h}=Z(),r=c=>c.startsWith("/esteira/")&&c!=="/esteira";return $(()=>o.path,(c,u)=>{u&&r(u)&&!r(c)&&(console.log(`🗑️ Saindo da página de processo ${u} - limpando cache`),h())}),he(()=>{o.path&&r(o.path)&&(console.log("🗑️ Componente desmontado - limpando cache de processos"),h())}),{clearCache:h,isProcessPage:r}},Ye={class:"min-h-screen bg-slate-950"},Qe={class:"app-header bg-slate-900 border-b border-slate-700 lg:hidden"},Ze={class:"flex items-center justify-between px-4 py-4"},Xe={class:"text-lg font-semibold text-white"},et={class:"flex-1"},rt={__name:"sidebar",setup(o){const h=B();Ke();const r=x(!1),c=x(!1),u=p(()=>{const m=h.path;return m==="/"?"Dashboard":m.startsWith("/admin")?"Administração":m.startsWith("/esteira")?"Esteira":m.startsWith("/processos")?"Processos":"DoCheck"});return $(()=>h.path,()=>{r.value=!1}),(m,t)=>(n(),f("div",Ye,[j(He,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=d=>r.value=d),onCollapsed:t[1]||(t[1]=d=>c.value=d)},null,8,["modelValue"]),s("div",{class:w(["min-h-screen transition-all duration-300 lg:pl-0",c.value?"lg:ml-16":"lg:ml-64"])},[s("header",Qe,[s("div",Ze,[s("h1",Xe,k(u.value),1),s("button",{onClick:t[2]||(t[2]=d=>r.value=!0),class:"p-2 rounded-md text-slate-300 hover:bg-slate-800"},[...t[3]||(t[3]=[s("i",{class:"fa-solid fa-bars text-lg"},null,-1)])])])]),s("main",et,[ve(m.$slots,"default")])],2),j(Ce),j(ge,{position:"bottom-center"})]))}};export{rt as default};
