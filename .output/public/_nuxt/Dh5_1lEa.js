import{_ as z,s as M,r as h,i as k,h as I,U as Y,c as u,o as c,a as s,m as g,p as E,n as b,v as P,t as _,d as q,F,j as G,k as R,a7 as Q,W as X,f as Z,b as A,l as ee,N as te,ag as se}from"./CPKTtwfv.js";import{_ as ae}from"./CCntQfpG.js";import{_ as oe}from"./DzLqderd.js";import"./B74M8xGS.js";const le={class:"relative"},ie=["title"],ne={key:0,class:"w-2 h-2 bg-white rounded-full opacity-80"},re={key:1,class:"bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full"},ce={key:0,class:"absolute left-full top-1/2 transform -translate-y-1/2 ml-2 z-50"},de={class:"bg-slate-800 text-white text-sm px-2 py-1 rounded shadow-lg whitespace-nowrap"},ue={__name:"SidebarItem",props:{item:{type:Object,required:!0},isActive:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1}},emits:["click","fetch-esteira"],setup(a,{emit:p}){const l=a,i=p,n=M(),r=h(!1),t=h(!1);let e=null;const o=k(()=>l.item.children&&l.item.children.length>0);function N(){l.item.path==="/esteira"&&i("fetch-esteira"),o.value&&!l.collapsed?t.value=!t.value:i("click",l.item)}function T(f){i("click",f)}function m(f){return f==="/"?n.path==="/":n.path.startsWith(f)}function V(){l.collapsed&&(e=setTimeout(()=>{r.value=!0},500))}function $(){e&&(clearTimeout(e),e=null),r.value=!1}return I(()=>l.isActive,f=>{f&&o.value&&(t.value=!0)}),I(()=>n.path,f=>{o.value&&l.item.children.some(C=>C.path==="/"?f==="/":f.startsWith(C.path))&&(t.value=!0)},{immediate:!0}),(f,y)=>{const C=Y("SidebarItem",!0);return c(),u("div",le,[s("button",{onClick:N,onMouseenter:V,onMouseleave:$,class:b(["w-full flex items-center gap-3 px-3 py-2 text-sm rounded-md transition-all duration-200 relative",a.isActive?"bg-orange-500 text-white shadow-lg":"text-slate-300 hover:text-white hover:bg-slate-800",a.collapsed?"justify-center":""]),title:a.collapsed?a.item.label:a.item.description},[s("i",{class:b([a.item.icon,"w-5 flex-shrink-0"])},null,2),E(s("span",{class:"flex-1 text-left truncate transition-opacity duration-300"},_(a.item.label),513),[[P,!a.collapsed]]),a.isActive&&!a.collapsed?(c(),u("div",ne)):g("",!0),a.item.badge&&!a.collapsed?(c(),u("span",re,_(a.item.badge),1)):g("",!0),o.value&&!a.collapsed?(c(),u("i",{key:2,class:b(["fa-solid fa-chevron-right text-xs transition-transform",t.value?"rotate-90":""])},null,2)):g("",!0)],42,ie),a.collapsed&&r.value?(c(),u("div",ce,[s("div",de,[q(_(a.item.label)+" ",1),y[0]||(y[0]=s("div",{class:"absolute right-full top-1/2 transform -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-r-4 border-transparent border-r-slate-800"},null,-1))])])):g("",!0),o.value&&!a.collapsed?(c(),u("div",{key:1,class:b(["mt-1 ml-8 space-y-1 overflow-hidden transition-all duration-300",t.value?"max-h-96 opacity-100":"max-h-0 opacity-0"])},[(c(!0),u(F,null,G(a.item.children,w=>(c(),R(C,{key:w.path,item:w,"is-active":m(w.path),collapsed:!1,onClick:S=>T(w)},null,8,["item","is-active","onClick"]))),128))],2)):g("",!0)])}}},W=z(ue,[["__scopeId","data-v-63b1924a"]]),x=h([]),j=h(!1),B=h(null),D="esteira-processes",U="esteira-processes-timestamp",pe=300*1e3,J=()=>{const a=()=>{if(typeof window>"u")return!1;const t=localStorage.getItem(D),e=localStorage.getItem(U);return t&&e&&Date.now()-parseInt(e)<pe?(x.value=JSON.parse(t),console.log("🗄️ Processos carregados do cache"),!0):!1},p=t=>{typeof window>"u"||(localStorage.setItem(D,JSON.stringify(t)),localStorage.setItem(U,Date.now().toString()))},l=()=>{typeof window>"u"||(localStorage.removeItem(D),localStorage.removeItem(U),x.value=[],console.log("🧹 Cache de processos limpo"))},i=async()=>{j.value=!0,B.value=null;try{const e=`${Q().public.FLOW_API_BASE}/api/v1/processes`;console.log("🔄 Buscando processos da API:",e);const o=await $fetch(e,{headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("📦 Resposta da API:",o),console.log("📦 Tipo da resposta:",typeof o),console.log("📦 É array?",Array.isArray(o)),Array.isArray(o)&&o.length>0&&(console.log("📦 Primeiro item:",o[0]),console.log("📦 Propriedades do primeiro item:",Object.keys(o[0]||{}))),Array.isArray(o)?(x.value=o,p(o),console.log(`✅ ${o.length} processos carregados e salvos no cache`)):(console.warn("⚠️ API não retornou um array:",o),x.value=[])}catch(t){console.error("❌ Erro ao buscar processos:",t),B.value="Erro ao carregar processos",x.value=[]}finally{j.value=!1}},n=k(()=>x.value.filter(t=>t.active===!0)),r=k(()=>n.value.map(t=>({label:t.name,path:`/esteira/${t.key}`,icon:"fa-solid fa-stream",description:`Esteira do processo ${t.name}`})));return{processes:x,activeProcesses:n,processMenuItems:r,loading:j,error:B,fetchProcesses:i,clearCache:l,loadFromCache:a}},fe={class:"sidebar-container"},me={class:"flex items-center justify-between p-4 border-b border-slate-700"},he={class:"flex items-center gap-3"},ve={class:"text-lg font-bold text-white transition-opacity duration-300"},ge={class:"flex items-center gap-2"},be=["title"],xe={class:"p-4 border-b border-slate-700"},ye={class:"flex items-center gap-3"},Ce=["title"],we={class:"flex-1 min-w-0 transition-opacity duration-300"},_e={class:"text-sm font-medium text-white truncate"},ke={class:"text-xs text-gray-400 truncate"},Se={class:"flex-1 px-4 py-6 space-y-2 overflow-y-auto"},Ae={class:"p-4 border-t border-slate-700"},Ie=["title"],$e={class:"transition-opacity duration-300"},Ee={__name:"Sidebar",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","collapsed"],setup(a,{emit:p}){const l=a,i=p,n=M(),r=X(),t=h({name:"Admin User",email:"admin@docheck.com"}),e=h(!1),{processMenuItems:o,fetchProcesses:N,loading:T}=J();Z(()=>{const d=localStorage.getItem("sidebar-collapsed");d!==null&&(e.value=JSON.parse(d),i("collapsed",e.value))});const m=k({get:()=>l.modelValue,set:d=>i("update:modelValue",d)}),V=k(()=>[{label:"Dashboard",path:"/",icon:"fa-solid fa-home",description:"Visão geral do sistema"},{label:"Esteira",path:"/esteira",icon:"fa-solid fa-sitemap",description:"Gerenciar fluxos de trabalho",children:T.value?[{label:"Carregando...",path:"/esteira/loading",icon:"fa-solid fa-spinner fa-spin",description:"Carregando processos"}]:o.value.length>0?o.value:[{label:"Nenhum processo ativo",path:"/esteira/empty",icon:"fa-solid fa-info-circle",description:"Nenhum processo ativo encontrado"}]},{label:"Processos",path:"/processos",icon:"fa-solid fa-clipboard-list",description:"Gerenciar processos"},{label:"Administração",path:"/admin",icon:"fa-solid fa-cog",description:"Configurações do sistema",roles:["admin"],children:[{label:"Usuários",path:"/admin/users",icon:"fa-solid fa-users",description:"Gerenciar usuários"},{label:"Esteira",path:"/admin/pipeline",icon:"fa-solid fa-sitemap",description:"Gerenciar pipeline"},{label:"Status",path:"/admin/status",icon:"fa-solid fa-circle-info",description:"Gerenciar status"},{label:"Notificações",path:"/admin/notifications",icon:"fa-solid fa-bell",description:"Gerenciar notificações"}]}]),$={label:"Configurações",path:"/settings",icon:"fa-solid fa-gear",description:"Configurações da conta"};function f(d){return d==="/"?n.path==="/":n.path.startsWith(d)}async function y(d){d.children&&d.children.length>0&&e.value&&(e.value=!1,localStorage.setItem("sidebar-collapsed",JSON.stringify(e.value)),i("collapsed",e.value)),d?.path&&d.path!=="/esteira"&&r.push(d.path),m.value&&S()}async function C(){console.log("🎯 Clicou no ícone da Esteira - buscando processos..."),await N(),console.log("✅ Processos atualizados:",o.value)}function w(){m.value=!0}function S(){m.value=!1}function L(){y($)}function H(){console.log("Logout clicked"),r.push("/login")}function K(){e.value=!e.value,localStorage.setItem("sidebar-collapsed",JSON.stringify(e.value)),i("collapsed",e.value)}return I(()=>n.path,()=>{m.value&&S()}),(d,v)=>(c(),u("div",fe,[m.value?(c(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:S})):g("",!0),s("nav",{class:b(["fixed top-0 left-0 h-screen bg-slate-900 border-r border-slate-700 transform transition-all duration-300 ease-in-out z-[100]","lg:translate-x-0",e.value?"w-16":"w-64",m.value?"translate-x-0":"-translate-x-full lg:translate-x-0"])},[s("div",me,[s("div",he,[A(ae,{size:"sm"}),E(s("h1",ve," DoCheck ",512),[[P,!e.value]])]),s("div",ge,[s("button",{onClick:K,class:"hidden lg:block p-1 rounded-md text-gray-400 hover:text-white hover:bg-gray-800 transition-colors",title:e.value?"Expandir sidebar":"Recolher sidebar"},[s("i",{class:b([e.value?"fa-solid fa-chevron-right":"fa-solid fa-chevron-left","text-sm"])},null,2)],8,be),m.value?(c(),u("button",{key:0,onClick:S,class:"lg:hidden p-1 rounded-md text-gray-400 hover:text-white hover:bg-gray-800"},[...v[0]||(v[0]=[s("i",{class:"fa-solid fa-times text-lg"},null,-1)])])):g("",!0)])]),s("div",xe,[s("div",ye,[s("div",{class:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center cursor-pointer hover:bg-orange-600 transition-colors",title:e.value?t.value?.name:""},[...v[1]||(v[1]=[s("i",{class:"fa-solid fa-user text-white text-sm"},null,-1)])],8,Ce),E(s("div",we,[s("p",_e,_(t.value?.name||"Usuário"),1),s("p",ke,_(t.value?.email||"user@example.com"),1)],512),[[P,!e.value]])])]),s("div",Se,[(c(!0),u(F,null,G(V.value,O=>(c(),R(W,{key:O.path,item:O,"is-active":f(O.path),collapsed:e.value,onClick:y,onFetchEsteira:C},null,8,["item","is-active","collapsed"]))),128))]),s("div",Ae,[A(W,{item:$,"is-active":!1,collapsed:e.value,onClick:L},null,8,["collapsed"]),s("button",{onClick:H,class:b(["w-full mt-2 flex items-center gap-3 px-3 py-2 text-gray-300 hover:text-white hover:bg-gray-800 rounded-md transition-colors text-sm",e.value?"justify-center":""]),title:e.value?"Sair":""},[v[2]||(v[2]=s("i",{class:"fa-solid fa-sign-out-alt w-5"},null,-1)),E(s("span",$e,"Sair",512),[[P,!e.value]])],10,Ie)])],2),m.value?g("",!0):(c(),u("button",{key:1,onClick:w,class:"fixed top-4 left-4 z-[110] lg:hidden p-2 rounded-md bg-gray-900 text-white hover:bg-gray-800 transition-colors"},[...v[3]||(v[3]=[s("i",{class:"fa-solid fa-bars text-lg"},null,-1)])]))]))}},Pe=z(Ee,[["__scopeId","data-v-253a7ee2"]]),Me=()=>{const a=M(),{clearCache:p}=J(),l=i=>i.startsWith("/esteira/")&&i!=="/esteira";return I(()=>a.path,(i,n)=>{n&&l(n)&&!l(i)&&(console.log(`🗑️ Saindo da página de processo ${n} - limpando cache`),p())}),ee(()=>{a.path&&l(a.path)&&(console.log("🗑️ Componente desmontado - limpando cache de processos"),p())}),{clearCache:p,isProcessPage:l}},Ne={class:"min-h-screen bg-slate-950"},Te={class:"bg-slate-900 border-b border-slate-700 lg:hidden"},Ve={class:"flex items-center justify-between px-4 py-3"},Oe={class:"text-lg font-semibold text-white"},je={class:"flex-1"},ze={__name:"sidebar",setup(a){const p=M();Me();const l=h(!1),i=h(!1),n=k(()=>{const r=p.path;return r==="/"?"Dashboard":r.startsWith("/admin")?"Administração":r.startsWith("/esteira")?"Esteira":r.startsWith("/processos")?"Processos":"DoCheck"});return I(()=>p.path,()=>{l.value=!1}),(r,t)=>(c(),u("div",Ne,[A(Pe,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),onCollapsed:t[1]||(t[1]=e=>i.value=e)},null,8,["modelValue"]),s("div",{class:b(["min-h-screen transition-all duration-300 lg:pl-0",i.value?"lg:ml-16":"lg:ml-64"])},[s("header",Te,[s("div",Ve,[s("h1",Oe,_(n.value),1),s("button",{onClick:t[2]||(t[2]=e=>l.value=!0),class:"p-2 rounded-md text-slate-300 hover:bg-slate-800"},[...t[3]||(t[3]=[s("i",{class:"fa-solid fa-bars text-lg"},null,-1)])])])]),s("main",je,[te(r.$slots,"default")])],2),A(oe),A(se,{position:"bottom-center"})]))}};export{ze as default};
