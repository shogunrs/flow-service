import{ae as B,r as a,i as F,f as $,l as q,c as n,a as e,m as c,t as _,n as k,z as O,d as C,V as H,Y as L,o as r}from"./CPKTtwfv.js";const U=window.setInterval,G={class:"min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 flex flex-col"},J={class:"flex-1 flex flex-col items-center justify-center p-4"},W={class:"relative w-80 h-80 max-w-sm"},Y={key:0,class:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center z-20"},K={class:"text-center text-white"},Q={class:"text-sm"},X={key:1,class:"absolute inset-0 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center z-20"},Z={class:"mt-6 text-center max-w-sm"},ee={class:"text-white text-sm mb-4"},te={class:"flex justify-center space-x-4 mb-4"},se={class:"flex items-center"},ae={class:"flex items-center"},oe={class:"flex items-center"},le=["disabled"],ne={key:1,disabled:"",class:"mt-6 bg-slate-600 text-white px-8 py-3 rounded-full text-lg font-semibold cursor-not-allowed"},re={key:3,class:"mt-4 p-3 bg-red-500 bg-opacity-20 border border-red-500 rounded-lg"},ie={class:"text-red-400 text-sm text-center"},de={__name:"[userId]",setup(ce){const M=B(),I=H(),E=M.params.userId,l=a(),u=a(!0),P=a("Iniciando câmera..."),d=a(!1),m=a(!1),v=a(""),g=a(!1),x=a(!1),p=a(!1),o=a("Posicione seu rosto dentro do círculo");let f=null,b=null;const y=F(()=>g.value&&x.value&&p.value&&!u.value);$(async()=>{await j(),z()}),q(()=>{V()});async function j(){try{P.value="Acessando câmera...";const s={video:{facingMode:"user",width:{ideal:640},height:{ideal:640},frameRate:{ideal:30}}};f=await navigator.mediaDevices.getUserMedia(s),l.value&&(l.value.srcObject=f,await l.value.play()),u.value=!1,o.value="Mantenha o rosto dentro do círculo e aguarde"}catch(s){console.error("Camera error:",s),v.value="Não foi possível acessar a câmera. Verifique as permissões.",u.value=!1}}function z(){b=U(()=>{!u.value&&!d.value&&(g.value=Math.random()>.3,x.value=Math.random()>.2,p.value=Math.random()>.4,y.value?o.value="Perfeito! Clique em Capturar quando estiver pronto":g.value?x.value?p.value||(o.value="Mantenha o rosto estável"):o.value="Posicione seu rosto no centro do círculo":o.value="Melhore a iluminação do ambiente")},500)}async function R(){if(y.value){d.value=!0,o.value="Processando reconhecimento facial...";try{const s=document.createElement("canvas"),t=s.getContext("2d");s.width=l.value.videoWidth,s.height=l.value.videoHeight,t.drawImage(l.value,0,0);const h=await new Promise(w=>{s.toBlob(w,"image/jpeg",.8)});await new Promise(w=>setTimeout(w,2e3));const i=S(),A=await T();await N(i,A),m.value=!0,o.value="Reconhecimento facial realizado com sucesso!"}catch(s){console.error("Capture error:",s),v.value="Erro durante o processamento. Tente novamente."}finally{d.value=!1}}}async function N(s,t){const{$api:h}=L(),i=await h(`/api/v1/mobile/users/${E}/face-recognition/process`,{method:"POST",body:{faceEmbedding:s,location:t}});if(!i.success)throw new Error(i.error||"Erro no processamento")}function S(){const s=Array.from({length:128},()=>Math.random()*2-1);return JSON.stringify(s)}async function T(){return new Promise(s=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(t=>{const{latitude:h,longitude:i}=t.coords;s(`${h},${i}`)},()=>s(null),{timeout:5e3,enableHighAccuracy:!1}):s(null)})}function D(){I.push("/mobile/success")}function V(){f&&(f.getTracks().forEach(s=>s.stop()),f=null),b&&(clearInterval(b),b=null)}return(s,t)=>(r(),n("div",G,[t[9]||(t[9]=e("div",{class:"bg-slate-800 px-4 py-3 shadow-lg"},[e("h1",{class:"text-xl font-semibold text-white text-center"}," Reconhecimento Facial "),e("p",{class:"text-sm text-slate-300 text-center mt-1"}," Posicione seu rosto na área indicada ")],-1)),e("div",J,[e("div",W,[t[2]||(t[2]=e("div",{class:"absolute inset-0 border-4 border-dashed border-white rounded-full opacity-50 z-10"},null,-1)),e("video",{ref_key:"videoElement",ref:l,class:"w-full h-full object-cover rounded-full bg-slate-700",autoplay:"",muted:"",playsinline:""},null,512),u.value?(r(),n("div",Y,[e("div",K,[t[0]||(t[0]=e("i",{class:"fa-solid fa-spinner fa-spin text-3xl mb-2"},null,-1)),e("p",Q,_(P.value),1)])])):c("",!0),m.value?(r(),n("div",X,[...t[1]||(t[1]=[e("i",{class:"fa-solid fa-check text-green-400 text-4xl"},null,-1)])])):c("",!0)]),e("div",Z,[e("p",ee,_(o.value),1),e("div",te,[e("div",se,[e("i",{class:k(["fa-solid fa-lightbulb mr-1",g.value?"text-green-400":"text-red-400"])},null,2),t[3]||(t[3]=e("span",{class:"text-xs text-slate-300"},"Iluminação",-1))]),e("div",ae,[e("i",{class:k(["fa-solid fa-user mr-1",x.value?"text-green-400":"text-red-400"])},null,2),t[4]||(t[4]=e("span",{class:"text-xs text-slate-300"},"Rosto",-1))]),e("div",oe,[e("i",{class:k(["fa-solid fa-camera mr-1",p.value?"text-green-400":"text-red-400"])},null,2),t[5]||(t[5]=e("span",{class:"text-xs text-slate-300"},"Posição",-1))])])]),!d.value&&!m.value?(r(),n("button",{key:0,onClick:R,disabled:!O(y),class:"mt-6 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white px-8 py-3 rounded-full text-lg font-semibold transition-colors"},[...t[6]||(t[6]=[e("i",{class:"fa-solid fa-camera mr-2"},null,-1),C(" Capturar ",-1)])],8,le)):c("",!0),d.value?(r(),n("button",ne,[...t[7]||(t[7]=[e("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1),C(" Processando... ",-1)])])):c("",!0),m.value?(r(),n("button",{key:2,onClick:D,class:"mt-6 bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full text-lg font-semibold transition-colors"},[...t[8]||(t[8]=[e("i",{class:"fa-solid fa-check mr-2"},null,-1),C(" Continuar ",-1)])])):c("",!0),v.value?(r(),n("div",re,[e("p",ie,_(v.value),1)])):c("",!0)]),t[10]||(t[10]=e("div",{class:"bg-slate-800 px-4 py-3 text-center"},[e("p",{class:"text-xs text-slate-400"}," Suas informações são protegidas e criptografadas ")],-1))]))}};export{de as default};
